(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{681:function(e,t,a){Promise.resolve().then(a.bind(a,3307))},3307:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var r=a(7437),s=a(2265),l=a(4887),i=a(9376),n=a(2141);class c{static async getCareStaff(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=arguments.length>3?arguments[3]:void 0;try{let s=n.O.from("care_staff_profiles").select("\n          id,\n          staff_id,\n          name_chinese,\n          phone,\n          preferred_area,\n          contract_status,\n          created_at,\n          job_position\n        ",{count:"exact"});if(e.search){let t="%".concat(e.search.trim(),"%");s=s.or("name_chinese.ilike.".concat(t,",phone.ilike.").concat(t,",staff_id.ilike.").concat(t))}if(e.gender&&(s=s.eq("gender",e.gender)),e.preferred_area&&(s=s.eq("preferred_area",e.preferred_area)),e.contract_status&&(s=s.eq("contract_status",e.contract_status)),e.job_position&&(s=s.contains("job_position",[e.job_position])),e.covid_vaccine&&(s=s.eq("covid_vaccine",e.covid_vaccine)),void 0!==e.has_certificate&&(s=e.has_certificate?s.or("\n            certificate_1.not.is.null,\n            certificate_2.not.is.null,\n            certificate_3.not.is.null,\n            certificate_4.not.is.null,\n            certificate_5.not.is.null\n          "):s.is("certificate_1",null).is("certificate_2",null).is("certificate_3",null).is("certificate_4",null).is("certificate_5",null)),e.language&&(s=s.contains("language",[e.language])),r){let e="asc"===r.direction;s=s.order(r.field,{ascending:e})}else s=s.order("created_at",{ascending:!1});let l=(t-1)*a;s=s.range(l,l+a-1);let{data:i,error:c,count:o}=await s;if(c)throw console.error("獲取護理人員列表失敗:",c),Error("獲取護理人員列表失敗: ".concat(c.message));return{data:i,count:o||0,total_pages:Math.ceil((o||0)/a),current_page:t,page_size:a}}catch(e){throw console.error("獲取護理人員列表失敗:",e),e}}static async getCareStaffSuggestions(e){try{var t;let a=null===(t=e.query)||void 0===t?void 0:t.trim();if(!a)return{data:[],count:0};let r=a.length,s=!1,l=[];if(r>=1&&(l.push("name_chinese.ilike.".concat("%".concat(a,"%"))),s=!0),r>=3&&l.push("staff_id.ilike.".concat("%".concat(a,"%"))),r>=4&&l.push("phone.ilike.".concat("%".concat(a,"%"))),!s||0===l.length)return{data:[],count:0};let{data:i,error:c}=await n.O.from("care_staff_profiles").select("id, name_chinese, staff_id, phone").or(l.join(",")).limit(20).order("name_chinese",{ascending:!0});if(c)throw console.error("獲取搜尋建議失敗:",c),Error("獲取搜尋建議失敗: ".concat(c.message));let o=(i||[]).map(e=>{var t,r,s;let l="name",i=a.toLowerCase(),n=null===(t=e.name_chinese)||void 0===t?void 0:t.toLowerCase().includes(i),c=null===(r=e.phone)||void 0===r?void 0:r.toLowerCase().includes(i),o=null===(s=e.staff_id)||void 0===s?void 0:s.toLowerCase().includes(i);return[n,c,o].filter(Boolean).length>1?l="mixed":n?l="name":c?l="phone":o&&(l="staff_id"),{id:e.id,name_chinese:e.name_chinese||"",staff_id:e.staff_id,phone:e.phone,match_type:l}});return{data:o,count:o.length}}catch(e){throw console.error("獲取搜尋建議失敗:",e),e}}static async getCareStaffById(e){try{let{data:t,error:a}=await n.O.from("care_staff_profiles").select("*").eq("id",e).single();if(a){if("PGRST116"===a.code)return{data:null,error:"找不到指定的護理人員"};throw console.error("獲取護理人員詳細資料失敗:",a),Error("獲取護理人員詳細資料失敗: ".concat(a.message))}return{data:t}}catch(e){throw console.error("獲取護理人員詳細資料失敗:",e),e}}static async createCareStaff(e){try{let t=this.validateFormData(e);if(Object.keys(t).length>0)throw Error("表單驗證失敗: ".concat(Object.values(t).join(", ")));let{data:a,error:r}=await n.O.from("care_staff_profiles").insert([e]).select().single();if(r)throw console.error("新增護理人員失敗:",r),Error("新增護理人員失敗: ".concat(r.message));return{data:a}}catch(e){throw console.error("新增護理人員失敗:",e),e}}static async updateCareStaff(e,t){try{if(void 0!==t.name_chinese&&!t.name_chinese.trim())throw Error("護理人員姓名不能為空");if(void 0!==t.phone&&!t.phone.trim())throw Error("聯絡電話不能為空");let{data:a,error:r}=await n.O.from("care_staff_profiles").update(t).eq("id",e).select().single();if(r)throw console.error("更新護理人員資料失敗:",r),Error("更新護理人員資料失敗: ".concat(r.message));return{data:a}}catch(e){throw console.error("更新護理人員資料失敗:",e),e}}static async getCareStaffOptions(){try{let[e,t]=await Promise.all([n.O.from("language_options").select("*").order("id"),n.O.from("job_position_options").select("*").order("id")]);if(e.error)throw console.error("獲取語言選項失敗:",e.error),Error("獲取語言選項失敗: ".concat(e.error.message));if(t.error)throw console.error("獲取職位選項失敗:",t.error),Error("獲取職位選項失敗: ".concat(t.error.message));return{languages:e.data||[],job_positions:t.data||[]}}catch(e){throw console.error("獲取選項資料失敗:",e),e}}static async uploadCareStaffFile(e,t){try{let{field_name:a,file:r}=t,s=Date.now(),l="".concat(s,"_").concat(r.name),i="care-staff/".concat(e,"/").concat(a,"/").concat(l),{data:c,error:o}=await n.O.storage.from("care-staff-files").upload(i,r);if(o)throw console.error("檔案上載失敗:",o),Error("檔案上載失敗: ".concat(o.message));let{data:d}=n.O.storage.from("care-staff-files").getPublicUrl(c.path);return d.publicUrl}catch(e){throw console.error("檔案上載失敗:",e),e}}static async removeCareStaffFile(e){try{let t=new URL(e).pathname.split("/"),a=t.findIndex(e=>"care-staff-files"===e);if(-1===a)throw Error("無效的檔案 URL");let r=t.slice(a+1).join("/"),{error:s}=await n.O.storage.from("care-staff-files").remove([r]);if(s)throw console.error("刪除檔案失敗:",s),Error("刪除檔案失敗: ".concat(s.message))}catch(e){throw console.error("刪除檔案失敗:",e),e}}static validateFormData(e){var t,a;let r={};return(null===(t=e.name_chinese)||void 0===t?void 0:t.trim())?e.name_chinese.trim().length<2?r.name_chinese="護理人員姓名至少需要2個字元":e.name_chinese.trim().length>50&&(r.name_chinese="護理人員姓名不能超過50個字元"):r.name_chinese="護理人員姓名為必填欄位",(null===(a=e.phone)||void 0===a?void 0:a.trim())?/^[2-9]\d{7}$|^[569]\d{7}$/.test(e.phone.replace(/\s+/g,""))||(r.phone="請輸入有效的香港電話號碼"):r.phone="聯絡電話為必填欄位",e.email&&e.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email.trim())&&(r.email="請輸入有效的電郵地址"),e.hkid&&e.hkid.trim()&&!/^[A-Z]{1,2}[0-9]{6}\([0-9A]\)$/.test(e.hkid.trim().toUpperCase())&&(r.hkid="請輸入有效的香港身份證號碼格式 (例：A123456(7))"),e.experience_years&&e.experience_years.trim()&&!/^\d+(\.\d+)?$/.test(e.experience_years.trim())&&(r.experience_years="年資請輸入數字格式 (例：2 或 2.5)"),r}static async deleteCareStaff(e){try{let{error:t}=await n.O.from("care_staff_profiles").delete().eq("id",e);if(t)return console.error("刪除護理人員失敗:",t),{success:!1,error:"刪除護理人員失敗: ".concat(t.message)};return{success:!0}}catch(e){return console.error("刪除護理人員失敗:",e),{success:!1,error:"刪除護理人員時發生錯誤，請稍後再試"}}}}class o{static validateFile(e){if(e.size>this.MAX_FILE_SIZE)return{valid:!1,error:"檔案太大，請選擇小於 10MB"};let t=e.name.toLowerCase(),a=this.ALLOWED_EXTENSIONS.some(e=>t.endsWith(e)),r=this.ALLOWED_TYPES.includes(e.type);return a&&r?{valid:!0}:{valid:!1,error:"不支援的格式（僅限 JPG/PNG/PDF）"}}static generateFilePath(e,t,a){let r=new Date().toISOString().replace(/[-:.]/g,"").slice(0,15),s=a.substring(a.lastIndexOf("."));return"care-staff/".concat(e,"/").concat(e,"_").concat(t,"_").concat(r).concat(s)}static async uploadFile(e,t,a,r){try{let s=this.validateFile(e);if(!s.valid)return{success:!1,error:s.error};let l=this.generateFilePath(t,a,e.name);null==r||r({progress:0,status:"uploading"});let{data:i,error:c}=await n.O.storage.from(this.BUCKET_NAME).upload(l,e,{cacheControl:"3600",upsert:!1});if(c)return console.error("Storage upload error:",c),null==r||r({progress:0,status:"error",error:"上載失敗，請稍後再試"}),{success:!1,error:"上載失敗，請稍後再試"};let{data:{publicUrl:o}}=n.O.storage.from(this.BUCKET_NAME).getPublicUrl(l);return null==r||r({progress:100,status:"success",url:o}),{success:!0,url:o}}catch(t){console.error("File upload error:",t);let e="上載失敗，請稍後再試";return null==r||r({progress:0,status:"error",error:e}),{success:!1,error:e}}}static async deleteFile(e){try{let{error:t}=await n.O.storage.from(this.BUCKET_NAME).remove([e]);if(t)return console.error("Storage delete error:",t),{success:!1,error:"刪除檔案失敗"};return{success:!0}}catch(e){return console.error("File delete error:",e),{success:!1,error:"刪除檔案失敗"}}}static extractFilePathFromUrl(e){try{let t=new URL(e).pathname.split("/"),a=t.findIndex(e=>"object"===e);if(-1!==a&&"public"===t[a+1])return t.slice(a+3).join("/");return null}catch(e){return null}}static async replaceFile(e,t,a,r,s){try{let l=await this.uploadFile(e,t,a,s);if(!l.success)return l;let i=this.extractFilePathFromUrl(r);return i&&await this.deleteFile(i),l}catch(e){return console.error("File replace error:",e),{success:!1,error:"替換檔案失敗"}}}}function d(e){let{label:t,fieldName:a,staffId:l,currentUrl:i,onUploadSuccess:c,onRemove:d,disabled:p=!1}=e,[x,m]=(0,s.useState)(null),[h,u]=(0,s.useState)(!1),f=(0,s.useRef)(null),g=(null==x?void 0:x.status)==="uploading",j=!!i,b=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r)try{let e=await o.uploadFile(r,l,a,m);e.success&&e.url?(c(e.url),f.current&&(f.current.value="")):alert(e.error||"上載失敗")}catch(e){console.error("檔案上載失敗:",e),alert("檔案上載失敗，請稍後再試")}finally{m(null)}},v=async()=>{if(i){u(!0);try{console.log("原始 URL:",i);let e="";if(i.includes("/storage/v1/object/public/")){let t=new URL(i).pathname.split("/"),a=t.findIndex(e=>"public"===e),r=t.findIndex(e=>"care-staff-files"===e);-1!==a&&-1!==r&&r>a&&(e=t.slice(r+1).join("/"))}if(!e&&i.includes("care-staff-files/")){let t=i.split("care-staff-files/");t.length>1&&(e=t[1])}if(!e&&i.includes("care-staff/")){let t=i.split("care-staff/");t.length>1&&(e="care-staff/"+t[1])}if(console.log("解析的檔案路徑:",e),!e)throw Error("無法解析檔案路徑，URL格式不正確");let{data:t,error:a}=await n.O.storage.from("care-staff-files").createSignedUrl(e,1800);if(a){console.error("生成簽名 URL 失敗:",a),console.log("嘗試直接打開原始 URL..."),window.open(i,"_blank");return}(null==t?void 0:t.signedUrl)?(console.log("成功生成簽名 URL:",t.signedUrl),window.open(t.signedUrl,"_blank")):(console.log("無簽名 URL，嘗試原始 URL..."),window.open(i,"_blank"))}catch(e){console.error("生成檔案連結失敗:",e);try{console.log("使用備用方案打開原始 URL..."),window.open(i,"_blank")}catch(e){console.error("備用方案也失敗:",e),alert("無法打開檔案，請檢查檔案是否存在或聯絡管理員")}}finally{u(!1)}}};return(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:t}),(0,r.jsx)("div",{className:"mt-2",children:j?(0,r.jsxs)("div",{className:"border border-border-light rounded-apple-sm p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-text-primary",children:t}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary",children:"已上載"})]})]}),(0,r.jsx)("button",{type:"button",onClick:v,disabled:h,className:"px-4 py-2 text-sm bg-mingcare-blue text-white rounded-apple-sm hover:bg-blue-600 transition-colors disabled:opacity-50",children:h?"生成中...":"點擊查看"})]}),(0,r.jsx)("div",{className:"mt-2 text-xs text-text-tertiary",children:"\uD83D\uDCA1 點擊「點擊查看」會生成30分鐘有效的安全連結"})]}):(0,r.jsxs)("div",{className:"border-2 border-dashed border-border-light rounded-apple-sm p-6 text-center hover:border-mingcare-blue transition-colors",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-text-tertiary",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,r.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{if(!p&&!g){var e;null===(e=f.current)||void 0===e||e.click()}},disabled:p||g,className:"px-4 py-2 bg-mingcare-blue text-white rounded-apple-sm text-sm hover:bg-blue-600 transition-colors disabled:opacity-50",children:g?"上載中...":"上載檔案"}),(0,r.jsx)("p",{className:"mt-2 text-xs text-text-tertiary",children:"JPG, PNG, PDF (最大 10MB)"})]}),g&&(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-4",children:(0,r.jsx)("div",{className:"bg-mingcare-blue h-2 rounded-full transition-all duration-300",style:{width:"".concat((null==x?void 0:x.progress)||0,"%")}})}),(null==x?void 0:x.status)==="error"&&(0,r.jsx)("p",{className:"text-red-600 text-xs mt-2",children:x.error})]})}),(0,r.jsx)("input",{ref:f,type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:b,className:"hidden"})]})}function p(){let[e,t]=(0,s.useState)(null),[a,o]=(0,s.useState)(!0),[p,x]=(0,s.useState)([]),[m,h]=(0,s.useState)("card"),[u,f]=(0,s.useState)({}),[g,j]=(0,s.useState)(""),[b,v]=(0,s.useState)([]),[y,N]=(0,s.useState)(!1),[_,w]=(0,s.useState)(-1),[k,C]=(0,s.useState)({top:0,left:0,width:0}),[S,L]=(0,s.useState)(!1),[E,M]=(0,s.useState)(0),[D,O]=(0,s.useState)(1),[U]=(0,s.useState)(20),[W,I]=(0,s.useState)({field:"created_at",direction:"desc"}),[T,B]=(0,s.useState)(null),F=(0,s.useRef)(null),[R,P]=(0,s.useState)(!1),[V,A]=(0,s.useState)(null),[z,H]=(0,s.useState)(!1),[J,q]=(0,s.useState)(!1),[X,Z]=(0,s.useState)({}),[G,Y]=(0,s.useState)(!1),[K,$]=(0,s.useState)([]),[Q,ee]=(0,s.useState)([]),[et,ea]=(0,s.useState)(!1),er=(0,i.useRouter)();(0,s.useEffect)(()=>{L(!0)},[]);let es=()=>{if(!F.current)return;let e=F.current.getBoundingClientRect(),t=window.scrollY,a=window.scrollX;C({top:e.bottom+t+2,left:e.left+a,width:e.width})},el=e=>({陪診員:"bg-blue-100 text-blue-800",居家照顧員:"bg-green-100 text-green-800",家務助理:"bg-yellow-100 text-yellow-800",醫護支援人員:"bg-purple-100 text-purple-800",保健員:"bg-cyan-100 text-cyan-800",登記護士:"bg-indigo-100 text-indigo-800",註冊護士:"bg-blue-100 text-blue-800",護士學生:"bg-sky-100 text-sky-800",中國護士:"bg-teal-100 text-teal-800",註冊營養師:"bg-orange-100 text-orange-800",職業治療師:"bg-emerald-100 text-emerald-800",言語治療師:"bg-rose-100 text-rose-800",物理治療師:"bg-lime-100 text-lime-800",醫生:"bg-red-100 text-red-800",抽血員:"bg-pink-100 text-pink-800",物理治療助理:"bg-amber-100 text-amber-800",職業治療助理:"bg-violet-100 text-violet-800"})[e.replace(/\s*\([^)]*\)/g,"").trim()]||"bg-gray-100 text-gray-800",ei=e=>e.replace(/\s*\([^)]*\)/g,"").trim();(0,s.useEffect)(()=>{(async()=>{let{data:{user:e}}=await n.O.auth.getUser();e?(t(e),await en()):er.push("/"),o(!1)})()},[er]),(0,s.useEffect)(()=>{w(-1)},[b]),(0,s.useEffect)(()=>{if(!y)return;let e=()=>es(),t=()=>es();return window.addEventListener("scroll",e),window.addEventListener("resize",t),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",t)}},[y]);let en=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0;try{let r=void 0!==e?e:u,{data:s,count:l}=await c.getCareStaff(r,t,U,void 0!==a?a:W);x(s),M(l)}catch(e){console.error("載入護理人員列表失敗:",e)}},[ec,eo]=(0,s.useState)(!1),ed=async e=>{if(e.length<1){v([]),N(!1);return}try{console.log("開始搜尋建議:",e);let t=(await c.getCareStaffSuggestions({query:e})).data||[];console.log("搜尋建議結果:",t.length,"筆"),v(t),es(),N(!0)}catch(e){console.error("載入搜尋建議失敗:",e),v([]),N(!1)}},ep=async e=>{let t=e||g;if(t.trim()){let e={...u,search:t.trim()};f(e),O(1),await en(e,1)}N(!1)},ex=e=>{j(e.name_chinese),N(!1),ep(e.name_chinese)},em=e=>{let t=W.field===e&&"asc"===W.direction?"desc":"asc",a={field:e,direction:t};I(a),O(1),en(u,1,a)},eh=async e=>{try{H(!0);let t=await c.getCareStaffById(e.id);t.data?(A(t.data),P(!0),Z({hkid_copy_url:t.data.hkid_copy_url||"",certificate_1:t.data.certificate_1||"",certificate_2:t.data.certificate_2||"",certificate_3:t.data.certificate_3||"",certificate_4:t.data.certificate_4||"",certificate_5:t.data.certificate_5||"",scrc_status:t.data.scrc_status||""})):alert(t.error||"無法載入護理人員詳細資料")}catch(e){console.error("載入護理人員詳細資料失敗:",e),alert("載入失敗，請稍後再試")}finally{H(!1)}},eu=async e=>{if(confirm("確定要刪除護理人員「".concat(e.name_chinese,"」嗎？\n\n此操作無法復原。")))try{H(!0);let t=await c.deleteCareStaff(e.id);t.success?(await en(),P(!1),A(null),alert("護理人員已成功刪除")):alert(t.error||"刪除失敗，請稍後再試")}catch(e){console.error("刪除護理人員時發生錯誤:",e),alert("刪除失敗，請稍後再試")}finally{H(!1)}},ef=async e=>{if(V)try{var t,a,r,s,l;q(!0);let i=e.get("name_chinese"),n=e.get("phone"),o=e.get("contract_status");if(!(null==i?void 0:i.trim())){alert("中文姓名為必填欄位");return}if(!(null==n?void 0:n.trim())){alert("聯絡電話為必填欄位");return}if(!/^\d{8}$/.test(n.replace(/\s+/g,""))){alert("聯絡電話必須為8位數字");return}if(!o){alert("合約狀態為必填欄位");return}let d={name_chinese:i.trim(),name_english:(null===(t=e.get("name_english"))||void 0===t?void 0:t.trim())||void 0,phone:n.replace(/\s+/g,""),email:(null===(a=e.get("email"))||void 0===a?void 0:a.trim())||void 0,hkid:(null===(r=e.get("hkid"))||void 0===r?void 0:r.trim())||void 0,dob:e.get("dob")||void 0,gender:e.get("gender")||void 0,preferred_area:e.get("preferred_area")||void 0,emergency_contact:(null===(s=e.get("emergency_contact"))||void 0===s?void 0:s.trim())||void 0,emergency_contact_phone:(null===(l=e.get("emergency_contact_phone"))||void 0===l?void 0:l.trim())||void 0},p=await c.updateCareStaff(V.id,d);p.data?(alert("護理人員資料已更新"),P(!1),A(null),await en()):alert(p.error||"更新失敗")}catch(e){console.error("更新護理人員資料失敗:",e),alert("更新失敗，請稍後再試")}finally{q(!1)}},eg=async(e,t)=>{if(V)try{Y(!0),Z(a=>({...a,[e]:t})),(await c.updateCareStaff(V.id,{[e]:t})).data?(A(a=>a?{...a,[e]:t}:null),alert("檔案上載成功")):(Z(t=>({...t,[e]:V[e]||""})),alert("更新資料庫失敗，已還原檔案狀態"))}catch(t){console.error("文件上載回寫失敗:",t),Z(t=>({...t,[e]:V[e]||""})),alert("更新資料庫失敗，已還原檔案狀態")}finally{Y(!1)}},ej=async e=>{if(V)try{Y(!0),(await c.updateCareStaff(V.id,{[e]:null})).data?(Z(t=>({...t,[e]:""})),A(t=>t?{...t,[e]:null}:null),alert("檔案連結已移除")):alert("移除失敗，請稍後再試")}catch(e){console.error("文件移除失敗:",e),alert("移除失敗，請稍後再試")}finally{Y(!1)}};return a?(0,r.jsx)("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-mingcare-blue"}),(0,r.jsx)("p",{className:"mt-4 text-text-secondary",children:"載入中..."})]})}):(0,r.jsxs)("div",{className:"min-h-screen bg-bg-primary",children:[(0,r.jsx)("header",{className:"card-apple border-b border-border-light fade-in-apple sticky top-0 z-10",children:(0,r.jsx)("div",{className:"px-3 sm:px-4 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-3 sm:py-4 lg:py-6",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h1",{className:"text-base sm:text-lg lg:text-xl font-bold text-text-primary mb-1 truncate",children:"護理人員管理"}),(0,r.jsx)("p",{className:"text-xs sm:text-sm text-text-secondary hidden sm:block",children:"管理護理人員資料和文件"})]}),(0,r.jsx)("button",{onClick:()=>er.push("/dashboard"),className:"btn-apple-secondary text-xs px-3 py-2 ml-3 flex-shrink-0",children:"返回"})]})})}),(0,r.jsxs)("main",{className:"px-3 sm:px-4 lg:px-8 py-3 sm:py-4 lg:py-6",children:[(0,r.jsx)("div",{className:"card-apple mb-3 sm:mb-4 lg:mb-6 fade-in-apple",style:{animationDelay:"0.1s"},children:(0,r.jsxs)("div",{className:"card-apple-content p-3 sm:p-4 lg:p-6",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 sm:pl-4",children:(0,r.jsx)("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-text-tertiary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsx)("input",{ref:F,type:"text",value:g,onChange:e=>{let t=e.target.value;j(t),ec||(T&&clearTimeout(T),t.length>=1?B(setTimeout(()=>{ed(t)},200)):(v([]),N(!1)))},onCompositionStart:()=>{eo(!0)},onCompositionEnd:e=>{eo(!1);let t=e.currentTarget.value;t.length>=1?ed(t):(v([]),N(!1))},onKeyDown:e=>{if(y&&b.length>0)switch(e.key){case"ArrowDown":e.preventDefault(),w(e=>e<b.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),w(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),_>=0&&_<b.length?ex(b[_]):ep();break;case"Escape":N(!1),w(-1)}else"Enter"===e.key?ep():"Escape"===e.key&&N(!1)},onFocus:()=>{es(),g.length>=1&&b.length>0&&N(!0)},onBlur:()=>{setTimeout(()=>{N(!1)},150)},placeholder:"智慧搜尋：姓名1字/員工編號3字/電話4字...",className:"w-full pl-8 sm:pl-12 pr-8 sm:pr-12 py-2 sm:py-3 border border-border-light rounded-apple-pill bg-white text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent transition-all duration-200 text-sm sm:text-base"}),(0,r.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 sm:pr-4",children:g&&(0,r.jsx)("button",{onClick:()=>{j("");let e={...u};delete e.search,f(e),O(1),en(e,1)},className:"p-1 text-text-tertiary hover:text-text-secondary transition-colors rounded-full hover:bg-bg-tertiary",children:(0,r.jsx)("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),S&&y&&g.length>=1&&(0,l.createPortal)((0,r.jsx)("div",{className:"fixed bg-white border border-border-light rounded-apple-sm shadow-apple-card max-h-80 overflow-y-auto z-[9999] scrollbar-thin scrollbar-thumb-bg-tertiary scrollbar-track-transparent",style:{top:"".concat(k.top,"px"),left:"".concat(k.left,"px"),width:"".concat(k.width,"px"),minWidth:"300px",scrollBehavior:"smooth",scrollbarWidth:"thin",scrollbarColor:"rgb(156 163 175) transparent"},onMouseDown:e=>e.preventDefault(),children:b.length>0?(0,r.jsxs)(r.Fragment,{children:[b.length>5&&(0,r.jsxs)("div",{className:"px-4 py-2 bg-bg-secondary border-b border-border-light text-xs text-text-secondary",children:["找到 ",b.length," 個結果，可上下滾動或使用 ↑↓ 鍵導航"]}),b.length<=5&&b.length>0&&(0,r.jsx)("div",{className:"px-4 py-1 bg-bg-secondary border-b border-border-light text-xs text-text-tertiary text-center",children:"使用 ↑↓ 鍵選擇，Enter 確認"}),b.map((e,t)=>{let a=t===_;return(0,r.jsx)("button",{onClick:()=>ex(e),className:"w-full text-left px-4 py-3 transition-colors border-b border-border-light last:border-b-0 group focus:outline-none ".concat(a?"bg-brand-primary text-white":"hover:bg-bg-tertiary focus:bg-bg-tertiary"),ref:e=>{a&&e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-medium transition-colors ".concat(a?"text-white":"text-text-primary group-hover:text-brand-primary group-focus:text-brand-primary"),children:e.name_chinese}),(0,r.jsxs)("div",{className:"text-xs mt-1 space-y-1 ".concat(a?"text-blue-100":"text-text-secondary"),children:[e.staff_id&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"mr-1",children:"\uD83D\uDC64"}),(0,r.jsx)("span",{children:e.staff_id})]}),e.phone&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"mr-1",children:"\uD83D\uDCDE"}),(0,r.jsx)("span",{children:e.phone})]})]})]}),(0,r.jsxs)("div",{className:"text-xs px-2 py-1 rounded-full transition-colors ".concat(a?"bg-blue-500 text-white":"text-text-tertiary bg-bg-secondary group-hover:bg-brand-secondary group-focus:bg-brand-secondary"),children:["name"===e.match_type&&"姓名","phone"===e.match_type&&"電話","staff_id"===e.match_type&&"編號","mixed"===e.match_type&&"混合"]})]})},e.id)})]}):(0,r.jsxs)("div",{className:"px-4 py-6 text-center text-text-secondary",children:[(0,r.jsx)("div",{className:"text-sm mb-2",children:"沒有找到相關護理人員"}),(0,r.jsx)("div",{className:"text-xs",children:"請嘗試其他關鍵字"})]})}),document.body)]}),"            ",(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple text-sm sm:text-base",children:"性別"}),(0,r.jsxs)("select",{value:u.gender||"",onChange:e=>{let t={...u};e.target.value?t.gender=e.target.value:delete t.gender,f(t),O(1),en(t,1)},className:"form-select-apple text-sm sm:text-base py-2 sm:py-3",children:[(0,r.jsx)("option",{value:"",children:"全部性別"}),(0,r.jsx)("option",{value:"男",children:"男性"}),(0,r.jsx)("option",{value:"女",children:"女性"})]})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple text-sm sm:text-base",children:"偏好地區"}),(0,r.jsxs)("select",{value:u.preferred_area||"",onChange:e=>{let t={...u};e.target.value?t.preferred_area=e.target.value:delete t.preferred_area,f(t),O(1),en(t,1)},className:"form-select-apple text-sm sm:text-base py-2 sm:py-3",children:[(0,r.jsx)("option",{value:"",children:"全部地區"}),(0,r.jsx)("option",{value:"所有區域",children:"所有區域"}),(0,r.jsx)("option",{value:"中西區",children:"中西區"}),(0,r.jsx)("option",{value:"東區",children:"東區"}),(0,r.jsx)("option",{value:"南區",children:"南區"}),(0,r.jsx)("option",{value:"灣仔區",children:"灣仔區"}),(0,r.jsx)("option",{value:"油尖旺區",children:"油尖旺區"}),(0,r.jsx)("option",{value:"深水埗區",children:"深水埗區"}),(0,r.jsx)("option",{value:"九龍城區",children:"九龍城區"}),(0,r.jsx)("option",{value:"黃大仙區",children:"黃大仙區"}),(0,r.jsx)("option",{value:"觀塘區",children:"觀塘區"}),(0,r.jsx)("option",{value:"西貢區",children:"西貢區"}),(0,r.jsx)("option",{value:"沙田區",children:"沙田區"}),(0,r.jsx)("option",{value:"大埔區",children:"大埔區"}),(0,r.jsx)("option",{value:"北區",children:"北區"}),(0,r.jsx)("option",{value:"荃灣區",children:"荃灣區"}),(0,r.jsx)("option",{value:"屯門區",children:"屯門區"}),(0,r.jsx)("option",{value:"元朗區",children:"元朗區"}),(0,r.jsx)("option",{value:"葵青區",children:"葵青區"}),(0,r.jsx)("option",{value:"離島區",children:"離島區"})]})]}),(0,r.jsxs)("div",{className:"form-group-apple sm:col-span-2 lg:col-span-1",children:[(0,r.jsx)("label",{className:"form-label-apple text-sm sm:text-base",children:"職位"}),(0,r.jsxs)("select",{value:u.job_position||"",onChange:e=>{let t={...u};e.target.value?t.job_position=e.target.value:delete t.job_position,f(t),O(1),en(t,1)},className:"form-select-apple text-sm sm:text-base py-2 sm:py-3",children:[(0,r.jsx)("option",{value:"",children:"全部職位"}),(0,r.jsx)("option",{value:"陪診員 (Medical Escort)",children:"陪診員 (Medical Escort)"}),(0,r.jsx)("option",{value:"居家照顧員(PCW)",children:"居家照顧員(PCW)"}),(0,r.jsx)("option",{value:"家務助理(Housekeeper)",children:"家務助理(Housekeeper)"}),(0,r.jsx)("option",{value:"醫護支援人員(CRSW)",children:"醫護支援人員(CRSW)"}),(0,r.jsx)("option",{value:"保健員(HCW)",children:"保健員(HCW)"}),(0,r.jsx)("option",{value:"登記護士(EN)",children:"登記護士(EN)"}),(0,r.jsx)("option",{value:"註冊護士(RN)",children:"註冊護士(RN)"}),(0,r.jsx)("option",{value:"護士學生",children:"護士學生"}),(0,r.jsx)("option",{value:"中國護士",children:"中國護士"}),(0,r.jsx)("option",{value:"註冊營養師(Dietitian)",children:"註冊營養師(Dietitian)"}),(0,r.jsx)("option",{value:"職業治療師(OT)",children:"職業治療師(OT)"}),(0,r.jsx)("option",{value:"言語治療師(ST)",children:"言語治療師(ST)"}),(0,r.jsx)("option",{value:"物理治療師(PT)",children:"物理治療師(PT)"}),(0,r.jsx)("option",{value:"醫生(Doctor)",children:"醫生(Doctor)"}),(0,r.jsx)("option",{value:"抽血員(Phlebotomist)",children:"抽血員(Phlebotomist)"}),(0,r.jsx)("option",{value:"物理治療助理 (PTA)",children:"物理治療助理 (PTA)"}),(0,r.jsx)("option",{value:"職業治療助理 (OTA)",children:"職業治療助理 (OTA)"})]})]})]}),(Object.keys(u).length>0||g.trim())&&(0,r.jsx)("div",{className:"mt-6 flex justify-end",children:(0,r.jsxs)("button",{onClick:async()=>{f({}),O(1),j(""),N(!1);try{o(!0);let{data:e,count:t}=await c.getCareStaff({},1,U);x(e),M(t)}catch(e){console.error("重新載入護理人員列表失敗:",e)}finally{o(!1)}},className:"text-sm text-text-secondary hover:text-text-primary flex items-center space-x-1 transition-colors",children:[(0,r.jsx)("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,r.jsx)("span",{children:"清除所有篩選"})]})})]})}),(0,r.jsx)("div",{className:"card-apple mb-3 sm:mb-4 lg:mb-6 fade-in-apple",style:{animationDelay:"0.2s"},children:(0,r.jsx)("div",{className:"card-apple-content p-3 sm:p-4 lg:p-6",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsx)("div",{className:"flex items-center space-x-6",children:(0,r.jsxs)("span",{className:"text-sm sm:text-base text-text-primary",children:["共 ",(0,r.jsx)("span",{className:"font-semibold text-mingcare-blue",children:E})," 位護理人員"]})}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)("div",{className:"flex rounded-apple-sm border border-border-light p-1 bg-bg-tertiary",children:[(0,r.jsx)("button",{onClick:()=>h("card"),className:"px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-apple-xs transition-all duration-200 ".concat("card"===m?"bg-white text-mingcare-blue shadow-apple":"text-text-secondary hover:text-text-primary"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,r.jsx)("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"卡片檢視"}),(0,r.jsx)("span",{className:"sm:hidden",children:"卡片"})]})}),(0,r.jsx)("button",{onClick:()=>h("list"),className:"px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-apple-xs transition-all duration-200 ".concat("list"===m?"bg-white text-mingcare-blue shadow-apple":"text-text-secondary hover:text-text-primary"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[(0,r.jsx)("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"列表檢視"}),(0,r.jsx)("span",{className:"sm:hidden",children:"列表"})]})})]})})]})})}),(0,r.jsx)("div",{className:"card-apple fade-in-apple",style:{animationDelay:"0.3s"},children:(0,r.jsx)("div",{className:"card-apple-content p-3 sm:p-4 lg:p-6",children:0===p.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-text-tertiary mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,r.jsx)("h3",{className:"text-apple-heading text-text-primary mb-2",children:Object.keys(u).length>0?"沒有符合條件的護理人員":"暫無護理人員資料"}),(0,r.jsx)("p",{className:"text-apple-body text-text-secondary mb-6",children:Object.keys(u).length>0?"請嘗試調整搜尋條件或篩選器":"目前還沒有護理人員資料"})]}):(0,r.jsx)(r.Fragment,{children:"list"===m?(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-border-light",children:[(0,r.jsx)("thead",{className:"bg-bg-secondary",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>em("name_chinese"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[(0,r.jsx)("span",{children:"護理人員"}),"name_chinese"===W.field&&(0,r.jsx)("svg",{className:"h-3 w-3 transform ".concat("desc"===W.direction?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>em("staff_id"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[(0,r.jsx)("span",{children:"員工編號"}),"staff_id"===W.field&&(0,r.jsx)("svg",{className:"h-3 w-3 transform ".concat("desc"===W.direction?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>em("preferred_area"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[(0,r.jsx)("span",{children:"偏好地區"}),"preferred_area"===W.field&&(0,r.jsx)("svg",{className:"h-3 w-3 transform ".concat("desc"===W.direction?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-tertiary uppercase tracking-wider",children:"職位"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>em("contract_status"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[(0,r.jsx)("span",{children:"合約狀態"}),"contract_status"===W.field&&(0,r.jsx)("svg",{className:"h-3 w-3 transform ".concat("desc"===W.direction?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),(0,r.jsx)("th",{className:"px-6 py-3 text-left",children:(0,r.jsxs)("button",{onClick:()=>em("created_at"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[(0,r.jsx)("span",{children:"建立日期"}),"created_at"===W.field&&(0,r.jsx)("svg",{className:"h-3 w-3 transform ".concat("desc"===W.direction?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-border-light",children:p.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-bg-tertiary transition-colors cursor-pointer",onClick:()=>eh(e),children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-apple-body text-text-primary font-medium",children:e.name_chinese}),(0,r.jsx)("div",{className:"text-apple-caption text-text-secondary",children:e.phone})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:e.staff_id||"沒有提供"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:e.preferred_area||"沒有提供"}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1 max-w-xs",children:e.job_position&&e.job_position.length>0?e.job_position.map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(el(e)),children:ei(e)},t)):(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"沒有提供"})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("同意"===e.contract_status?"bg-green-100 text-green-800":"不同意"===e.contract_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.contract_status||"沒有提供"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:new Date(e.created_at).toLocaleDateString("zh-TW")})]},e.id))})]})}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map((e,t)=>(0,r.jsx)("div",{className:"card-apple group cursor-pointer transition-all duration-200 hover:shadow-apple-card",style:{animationDelay:"".concat(.4+.05*t,"s")},onClick:()=>eh(e),children:(0,r.jsxs)("div",{className:"card-apple-content",children:[(0,r.jsx)("div",{className:"flex justify-between items-start mb-4",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-apple-heading text-text-primary truncate mb-1",children:e.name_chinese}),(0,r.jsx)("p",{className:"text-apple-caption text-text-secondary",children:e.staff_id||"沒有提供"})]})}),(0,r.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center text-apple-caption text-text-secondary",children:[(0,r.jsx)("svg",{className:"h-4 w-4 mr-3 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),(0,r.jsx)("span",{children:e.phone})]}),(0,r.jsxs)("div",{className:"flex items-center text-apple-caption text-text-secondary",children:[(0,r.jsxs)("svg",{className:"h-4 w-4 mr-3 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,r.jsx)("span",{children:e.preferred_area||"沒有提供"})]})]}),(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:e.job_position&&e.job_position.length>0?e.job_position.map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(el(e)),children:ei(e)},t)):(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"沒有提供"})})}),(0,r.jsx)("div",{className:"border-t border-border-light pt-3",children:(0,r.jsxs)("div",{className:"flex justify-between items-center text-apple-caption text-text-tertiary",children:[(0,r.jsxs)("span",{children:["建立於 ",new Date(e.created_at).toLocaleDateString("zh-TW")]}),(0,r.jsx)("svg",{className:"h-4 w-4 text-mingcare-blue group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})},e.id))})})})}),R&&V&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:()=>P(!1)}),(0,r.jsx)("div",{className:"absolute right-0 top-0 h-full w-full max-w-2xl bg-white shadow-xl transform transition-transform",children:(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"border-b border-border-light px-6 py-4 bg-bg-secondary",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-text-primary",children:"編輯護理人員"}),(0,r.jsxs)("p",{className:"text-sm text-text-secondary mt-1",children:[V.name_chinese," (",V.staff_id||"未分配編號",")"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:()=>eu(V),disabled:z,className:"px-4 py-2 bg-red-500 text-white rounded-apple-sm hover:bg-red-600 transition-colors disabled:opacity-50 text-sm",children:z?"刪除中...":"刪除"}),(0,r.jsx)("button",{onClick:()=>P(!1),className:"p-2 text-text-tertiary hover:text-text-primary transition-colors",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}),(0,r.jsx)("form",{action:ef,className:"flex-1 overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"基本資料"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"中文姓名 *"}),(0,r.jsx)("input",{type:"text",name:"name_chinese",defaultValue:V.name_chinese||"",className:"form-input-apple",placeholder:"請輸入中文姓名"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"員工編號"}),(0,r.jsx)("input",{type:"text",value:V.staff_id||"系統自動生成",className:"form-input-apple bg-bg-secondary",disabled:!0})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"英文姓名"}),(0,r.jsx)("input",{type:"text",name:"name_english",defaultValue:V.name_english||"",className:"form-input-apple",placeholder:"請輸入英文姓名"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.name_english?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"電子郵箱"}),(0,r.jsx)("input",{type:"email",name:"email",defaultValue:V.email||"",className:"form-input-apple",placeholder:"請輸入電子郵箱"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.email?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"身份證號碼"}),(0,r.jsx)("input",{type:"text",name:"hkid",defaultValue:V.hkid||"",className:"form-input-apple",placeholder:"請輸入身份證號碼"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.hkid?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"出生日期"}),(0,r.jsx)("input",{type:"date",name:"dob",defaultValue:V.dob||"",className:"form-input-apple"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.dob?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"聯絡電話 *"}),(0,r.jsx)("input",{type:"tel",name:"phone",defaultValue:V.phone||"",className:"form-input-apple",placeholder:"請輸入8位數電話號碼"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"性別"}),(0,r.jsxs)("select",{name:"gender",defaultValue:V.gender||"",className:"form-select-apple",children:[(0,r.jsx)("option",{value:"",children:"請選擇性別"}),(0,r.jsx)("option",{value:"男",children:"男性"}),(0,r.jsx)("option",{value:"女",children:"女性"})]}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.gender?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"偏好工作區域"}),(0,r.jsxs)("select",{name:"preferred_area",defaultValue:V.preferred_area||"",className:"form-select-apple",children:[(0,r.jsx)("option",{value:"",children:"請選擇偏好地區"}),(0,r.jsx)("option",{value:"所有區域",children:"所有區域"}),(0,r.jsx)("option",{value:"中西區",children:"中西區"}),(0,r.jsx)("option",{value:"東區",children:"東區"}),(0,r.jsx)("option",{value:"南區",children:"南區"}),(0,r.jsx)("option",{value:"灣仔區",children:"灣仔區"}),(0,r.jsx)("option",{value:"油尖旺區",children:"油尖旺區"}),(0,r.jsx)("option",{value:"深水埗區",children:"深水埗區"}),(0,r.jsx)("option",{value:"九龍城區",children:"九龍城區"}),(0,r.jsx)("option",{value:"黃大仙區",children:"黃大仙區"}),(0,r.jsx)("option",{value:"觀塘區",children:"觀塘區"}),(0,r.jsx)("option",{value:"西貢區",children:"西貢區"}),(0,r.jsx)("option",{value:"沙田區",children:"沙田區"}),(0,r.jsx)("option",{value:"大埔區",children:"大埔區"}),(0,r.jsx)("option",{value:"北區",children:"北區"}),(0,r.jsx)("option",{value:"荃灣區",children:"荃灣區"}),(0,r.jsx)("option",{value:"屯門區",children:"屯門區"}),(0,r.jsx)("option",{value:"元朗區",children:"元朗區"}),(0,r.jsx)("option",{value:"葵青區",children:"葵青區"}),(0,r.jsx)("option",{value:"離島區",children:"離島區"})]}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.preferred_area?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"合約狀態 *"}),(0,r.jsxs)("select",{name:"contract_status",defaultValue:V.contract_status||"",className:"form-select-apple",children:[(0,r.jsx)("option",{value:"",children:"請選擇合約狀態"}),(0,r.jsx)("option",{value:"同意",children:"同意"}),(0,r.jsx)("option",{value:"不同意",children:"不同意"})]}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.contract_status?"":"沒有提供"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"緊急聯絡資料"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"緊急聯絡人姓名"}),(0,r.jsx)("input",{type:"text",name:"emergency_contact",defaultValue:V.emergency_contact||"",className:"form-input-apple",placeholder:"請輸入緊急聯絡人姓名"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.emergency_contact?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"緊急聯絡人電話"}),(0,r.jsx)("input",{type:"tel",name:"emergency_contact_phone",defaultValue:V.emergency_contact_phone||"",className:"form-input-apple",placeholder:"請輸入緊急聯絡人電話"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.emergency_contact_phone?"":"沒有提供"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"其他資料"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"國籍"}),(0,r.jsx)("input",{type:"text",name:"nationality",defaultValue:V.nationality||"",className:"form-input-apple",placeholder:"請輸入國籍"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.nationality?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"年資（年）"}),(0,r.jsx)("input",{type:"text",name:"experience_years",defaultValue:V.experience_years||"",className:"form-input-apple",placeholder:"請輸入年資"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.experience_years?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"新冠疫苗"}),(0,r.jsxs)("select",{name:"covid_vaccine",defaultValue:V.covid_vaccine||"",className:"form-select-apple",children:[(0,r.jsx)("option",{value:"",children:"請選擇疫苗狀態"}),(0,r.jsx)("option",{value:"1針",children:"1針"}),(0,r.jsx)("option",{value:"2針",children:"2針"}),(0,r.jsx)("option",{value:"3針",children:"3針"}),(0,r.jsx)("option",{value:"4針",children:"4針"}),(0,r.jsx)("option",{value:"無接種",children:"無接種"}),(0,r.jsx)("option",{value:"Other",children:"其他"})]}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.covid_vaccine?"":"沒有提供"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"介紹人資料"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"介紹人姓名"}),(0,r.jsx)("input",{type:"text",name:"referrer",defaultValue:V.referrer||"",className:"form-input-apple",placeholder:"請輸入介紹人姓名"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.referrer?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"介紹人電話"}),(0,r.jsx)("input",{type:"tel",name:"referrer_phone",defaultValue:V.referrer_phone||"",className:"form-input-apple",placeholder:"請輸入介紹人電話"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.referrer_phone?"":"沒有提供"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"前雇主資料"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"公司名稱"}),(0,r.jsx)("input",{type:"text",name:"company_name",defaultValue:V.company_name||"",className:"form-input-apple",placeholder:"請輸入前雇主公司名稱"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.company_name?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"職位"}),(0,r.jsx)("input",{type:"text",name:"company_position",defaultValue:V.company_position||"",className:"form-input-apple",placeholder:"請輸入在前雇主的職位"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.company_position?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"任職期間"}),(0,r.jsx)("input",{type:"text",name:"employment_period",defaultValue:V.employment_period||"",className:"form-input-apple",placeholder:"請輸入任職期間"}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.employment_period?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple md:col-span-2",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"主要職責"}),(0,r.jsx)("textarea",{name:"main_duties",defaultValue:V.main_duties||"",className:"form-textarea-apple",placeholder:"請輸入主要職責",rows:3}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.main_duties?"":"沒有提供"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"職位與語言"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"申請職位"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:["陪診員 (Medical Escort)","居家照顧員(PCW)","家務助理(Housekeeper)","醫護支援人員(CRSW)","保健員(HCW)","登記護士(EN)","註冊護士(RN)","護士學生","中國護士","註冊營養師(Dietitian)","職業治療師(OT)","言語治療師(ST)","物理治療師(PT)","醫生(Doctor)","抽血員(Phlebotomist)","物理治療助理 (PTA)","職業治療助理 (OTA)"].map(e=>{var t;return(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",defaultChecked:null===(t=V.job_position)||void 0===t?void 0:t.includes(e),className:"rounded border-border-light text-mingcare-blue focus:ring-mingcare-blue mr-2"}),(0,r.jsx)("span",{className:"text-sm text-text-secondary",children:e})]},e)})}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.job_position&&V.job_position.length>0?"":"沒有提供"})]}),(0,r.jsxs)("div",{className:"form-group-apple",children:[(0,r.jsx)("label",{className:"form-label-apple",children:"語言能力"}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2",children:["廣東話","英文","普通話","福建話","潮州話","客家話","上海話","四邑話"].map(e=>{var t;return(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:(null==V?void 0:null===(t=V.language)||void 0===t?void 0:t.includes(e))||!1,onChange:t=>{let a;if(!V)return;let r=V.language||[];a=t.target.checked?[...r,e]:r.filter(t=>t!==e),A({...V,language:a})},className:"rounded border-border-light text-mingcare-blue focus:ring-mingcare-blue mr-2"}),(0,r.jsx)("span",{className:"text-sm text-text-secondary",children:e})]},e)})}),(0,r.jsx)("p",{className:"text-xs text-text-tertiary mt-1",children:V.language&&V.language.length>0?"":"沒有提供"})]})]})]}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"文件管理"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(d,{label:"身份證副本",fieldName:"hkid_copy_url",staffId:V.staff_id||"",currentUrl:X.hkid_copy_url,onUploadSuccess:e=>eg("hkid_copy_url",e),onRemove:()=>ej("hkid_copy_url"),disabled:G}),[1,2,3,4,5].map(e=>(0,r.jsx)(d,{label:"證書 ".concat(e),fieldName:"certificate_".concat(e),staffId:V.staff_id||"",currentUrl:X["certificate_".concat(e)],onUploadSuccess:t=>eg("certificate_".concat(e),t),onRemove:()=>ej("certificate_".concat(e)),disabled:G},e)),(0,r.jsx)(d,{label:"SCRC 文件",fieldName:"scrc_status",staffId:V.staff_id||"",currentUrl:X.scrc_status,onUploadSuccess:e=>eg("scrc_status",e),onRemove:()=>ej("scrc_status"),disabled:G})]})]})]})}),(0,r.jsx)("div",{className:"border-t border-border-light px-6 py-4 bg-bg-secondary",children:(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:()=>P(!1),type:"button",className:"px-4 py-2 border border-border-light rounded-apple-sm text-text-secondary hover:text-text-primary transition-colors",children:"取消"}),(0,r.jsx)("button",{onClick:e=>{var t;e.preventDefault();let a=null===(t=e.currentTarget.closest(".flex.flex-col.h-full"))||void 0===t?void 0:t.querySelector("form");a&&ef(new FormData(a))},disabled:J,type:"button",className:"px-4 py-2 bg-mingcare-blue text-white rounded-apple-sm hover:bg-blue-600 transition-colors disabled:opacity-50",children:J?"保存中...":"保存"})]})})]})})]})]})]})}o.BUCKET_NAME="care-staff-files",o.MAX_FILE_SIZE=10485760,o.ALLOWED_TYPES=["image/jpeg","image/png","application/pdf"],o.ALLOWED_EXTENSIONS=[".jpg",".jpeg",".png",".pdf"]},2141:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(3960).AY)("https://cvkxlvdicympakfecgvv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3hsdmRpY3ltcGFrZmVjZ3Z2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0MjkxODEsImV4cCI6MjA2NzAwNTE4MX0.jp2fPKcBcG4-042UoN3OieR553WAgABhJIujiDJAt-I")}},function(e){e.O(0,[998,971,117,744],function(){return e(e.s=681)}),_N_E=e.O()}]);