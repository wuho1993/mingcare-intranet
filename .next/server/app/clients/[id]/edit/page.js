(()=>{var e={};e.id=953,e.ids=[953],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},8065:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>c}),a(1580),a(1506),a(5866);var s=a(3191),r=a(8716),i=a(7922),l=a.n(i),n=a(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);a.d(t,o);let c=["",{children:["clients",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,1580)),"/Users/joecheung/Documents/GitHub/mingcare-intranet/app/clients/[id]/edit/page.tsx"]}]},{}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,4998))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,1506)),"/Users/joecheung/Documents/GitHub/mingcare-intranet/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,4998))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/joecheung/Documents/GitHub/mingcare-intranet/app/clients/[id]/edit/page.tsx"],p="/clients/[id]/edit/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/clients/[id]/edit/page",pathname:"/clients/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1287:(e,t,a)=>{Promise.resolve().then(a.bind(a,3055))},8505:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,2994,23)),Promise.resolve().then(a.t.bind(a,6114,23)),Promise.resolve().then(a.t.bind(a,9727,23)),Promise.resolve().then(a.t.bind(a,9671,23)),Promise.resolve().then(a.t.bind(a,1868,23)),Promise.resolve().then(a.t.bind(a,4759,23))},4555:()=>{},3055:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var s=a(326),r=a(7577),i=a(5047);a(5442);var l=a(9741);function n({params:e}){let[t,a]=(0,r.useState)(null),[n,o]=(0,r.useState)(!0),[c,d]=(0,r.useState)(!1),[p,u]=(0,r.useState)(""),[m,h]=(0,r.useState)(""),[x,v]=(0,r.useState)(!1),[_,g]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[y,N]=(0,r.useState)({customer_type:"社區券客戶",customer_name:"",service_address:"",charity_support:!1}),[f,k]=(0,r.useState)({}),w=(0,i.useRouter)(),C=e=>{if(!e)return;let t=new Date(e),a=new Date,s=a.getFullYear()-t.getFullYear(),r=a.getMonth()-t.getMonth();return(r<0||0===r&&a.getDate()<t.getDate())&&s--,s>=0?s:void 0},q=(e,t)=>{("customer_type"===e||"introducer"===e||"voucher_application_status"===e)&&b(!0),N(a=>{let s={...a,[e]:t};return"dob"===e&&(s.age=C(t)),x&&("customer_type"===e&&("明家街客"===t?(s.voucher_application_status=void 0,s.voucher_number="",s.copay_level=void 0,s.charity_support=void 0,s.lds_status=void 0,s.home_visit_status=void 0):"社區券客戶"===t&&(s.voucher_application_status=void 0,s.voucher_number="",s.copay_level=void 0,s.charity_support=void 0,s.lds_status=void 0,s.home_visit_status=void 0)),"voucher_application_status"===e&&("已經持有"===t?s.lds_status="已經持有":"申請中"===t?(s.voucher_number="",s.copay_level=void 0,s.charity_support=void 0,s.lds_status=void 0):(s.voucher_number="",s.copay_level=void 0,s.charity_support=void 0,s.lds_status=void 0,s.home_visit_status=void 0)),"copay_level"===e&&"5%"!==t&&(s.charity_support=void 0)),s}),f[e]&&k(t=>{let a={...t};return delete a[e],a})},D=()=>{let e={};return y.customer_name?.trim()||(e.customer_name="請輸入客戶姓名"),y.service_address?.trim()||(e.service_address="請輸入服務地址"),x&&"社區券客戶"===y.customer_type&&(y.voucher_application_status||(e.voucher_application_status="請選擇社區券申請狀況"),"已經持有"===y.voucher_application_status&&(y.voucher_number?.trim()||(e.voucher_number="請輸入社區券號碼"),y.copay_level||(e.copay_level="請選擇自付比例等級"),"5%"===y.copay_level&&void 0===y.charity_support&&(e.charity_support="請選擇是否需要慈善機構贊助")),"申請中"!==y.voucher_application_status&&"已經持有"!==y.voucher_application_status||(y.lds_status||(e.lds_status="請選擇LDS狀況"),y.home_visit_status||(e.home_visit_status="請選擇家訪狀況"))),k(e),0===Object.keys(e).length},I=async t=>{if(t.preventDefault(),D()){d(!0);try{let t;if(y.dob){let e=new Date(y.dob),a=new Date;t=a.getFullYear()-e.getFullYear();let s=a.getMonth()-e.getMonth();(s<0||0===s&&a.getDate()<e.getDate())&&t--}let a={...y,age:t||y.age,customer_id:x?m:p},s=await l.n.updateCustomer(e.id,a);s.error?k({general:s.error}):w.push("/clients")}catch(e){console.error("Failed to update customer:",e),k({general:e.message||"更新客戶資料失敗"})}finally{d(!1)}}},S=async()=>{if(window.confirm(`確定要刪除客戶「${y.customer_name}」嗎？

此操作無法復原，將永久刪除所有相關資料。`)){d(!0);try{let t=await l.n.deleteCustomer(e.id);t.error?k({general:t.error}):w.push("/clients")}catch(e){console.error("Failed to delete customer:",e),k({general:e.message||"刪除客戶失敗"})}finally{d(!1)}}};return n?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-bg-primary",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-2 border-mingcare-blue border-t-transparent"}),s.jsx("p",{className:"text-apple-body text-text-secondary mt-4",children:"載入中..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-bg-primary",children:[s.jsx("header",{className:"card-apple border-b border-border-light fade-in-apple",children:s.jsx("div",{className:"max-w-4xl mx-auto px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center py-8",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-apple-title text-text-primary mb-2",children:"編輯客戶資料"}),s.jsx("p",{className:"text-apple-body text-text-secondary",children:"更新客戶的基本資料和服務資訊"})]}),(0,s.jsxs)("button",{onClick:()=>w.push("/clients"),className:"btn-apple-secondary",children:[s.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"返回客戶列表"]})]})})}),s.jsx("main",{className:"max-w-4xl mx-auto py-8 px-6 lg:px-8",children:(0,s.jsxs)("form",{onSubmit:I,className:"space-y-8",children:[f.general&&s.jsx("div",{className:"card-apple border-danger bg-danger-light fade-in-apple",children:s.jsx("div",{className:"card-apple-content",children:(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("svg",{className:"h-5 w-5 text-danger mr-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{className:"text-apple-body text-danger",children:f.general})]})})}),s.jsx("div",{className:"card-apple fade-in-apple",children:(0,s.jsxs)("div",{className:"card-apple-content",children:[s.jsx("h2",{className:"text-apple-heading text-text-primary mb-6",children:"客戶編號管理"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"客戶編號"}),s.jsx("input",{type:"text",value:x?m:p,readOnly:!0,className:"form-input-apple bg-bg-secondary w-full",placeholder:"載入中..."}),p&&!x&&(0,s.jsxs)("p",{className:"text-apple-caption text-text-secondary mt-2",children:["目前使用：",p]}),x&&m&&(0,s.jsxs)("p",{className:"text-apple-caption text-success mt-2",children:["✓ 將使用新編號：",m]})]}),_&&m&&s.jsx("div",{className:"bg-bg-tertiary rounded-apple-sm p-4 border border-border-light",children:(0,s.jsxs)("div",{className:"flex items-start space-x-3 mb-4",children:[s.jsx("svg",{className:"h-5 w-5 text-mingcare-blue mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-apple-body font-medium text-text-primary mb-2",children:"系統偵測到可以生成新的客戶編號"}),(0,s.jsxs)("p",{className:"text-apple-caption text-text-secondary mb-4",children:["根據目前的客戶類型（",y.customer_type,"）和介紹人（",y.introducer,"）， 系統可以為此客戶生成新的編號：",s.jsx("span",{className:"font-medium text-mingcare-blue",children:m})]}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>{v(!1),g(!1),b(!1)},className:"btn-apple-secondary text-sm",children:["保留原編號（",p,"）"]}),(0,s.jsxs)("button",{type:"button",onClick:()=>{v(!0),g(!1),b(!1)},className:"btn-apple-primary text-sm",children:["使用新編號（",m,"）"]})]})]})]})}),f.customerIdGeneration&&s.jsx("div",{className:"bg-danger-light border border-danger rounded-apple-sm p-3",children:s.jsx("p",{className:"text-apple-caption text-danger",children:f.customerIdGeneration})})]})]})}),s.jsx("div",{className:"card-apple fade-in-apple",children:(0,s.jsxs)("div",{className:"card-apple-content",children:[s.jsx("h2",{className:"text-apple-heading text-text-primary mb-6",children:"基礎資訊"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:["客戶類型 ",s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("select",{value:y.customer_type,onChange:e=>q("customer_type",e.target.value),className:"form-input-apple",required:!0,children:[s.jsx("option",{value:"社區券客戶",children:"社區券客戶"}),s.jsx("option",{value:"明家街客",children:"明家街客"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:["介紹人 ",s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("select",{value:y.introducer||"",onChange:e=>q("introducer",e.target.value),className:"form-input-apple",required:!0,children:[s.jsx("option",{value:"",children:"請選擇介紹人"}),s.jsx("option",{value:"Kanas Leung",children:"Kanas Leung"}),s.jsx("option",{value:"Joe Cheung",children:"Joe Cheung"}),s.jsx("option",{value:"Candy Ho",children:"Candy Ho"}),s.jsx("option",{value:"Steven Kwok",children:"Steven Kwok"}),s.jsx("option",{value:"Dr.Lee",children:"Dr.Lee"}),s.jsx("option",{value:"Annie",children:"Annie"}),s.jsx("option",{value:"Janet",children:"Janet"}),s.jsx("option",{value:"陸sir",children:"陸sir"}),s.jsx("option",{value:"吳翹政",children:"吳翹政"}),s.jsx("option",{value:"余翠英",children:"余翠英"}),s.jsx("option",{value:"陳小姐MC01",children:"陳小姐MC01"}),s.jsx("option",{value:"曾先生",children:"曾先生"})]}),x&&s.jsx("p",{className:"text-apple-caption text-text-secondary mt-1",children:"請先選擇介紹人，確定後才會生成客戶編號"})]})]}),"社區券客戶"===y.customer_type&&(0,s.jsxs)("div",{className:"mt-6 pt-6 border-t border-border-primary",children:[s.jsx("h3",{className:"text-apple-body font-semibold text-text-primary mb-4",children:"社區券資訊"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-caption font-medium text-text-primary mb-2",children:["申請狀況 ",x&&s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("select",{value:y.voucher_application_status||"",onChange:e=>q("voucher_application_status",e.target.value),className:`form-input-apple ${f.voucher_application_status?"border-danger":""}`,required:x,children:[s.jsx("option",{value:"",children:"請選擇申請狀況"}),s.jsx("option",{value:"已經持有",children:"已經持有"}),s.jsx("option",{value:"申請中",children:"申請中"})]}),f.voucher_application_status&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.voucher_application_status}),x&&"申請中"===y.voucher_application_status&&s.jsx("p",{className:"text-apple-caption text-text-secondary mt-1",children:"申請中狀態不會生成客戶編號"})]}),(!x||"申請中"===y.voucher_application_status||"已經持有"===y.voucher_application_status)&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-caption font-medium text-text-primary mb-2",children:["LDS 狀態 ",x&&s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("select",{value:y.lds_status||"",onChange:e=>q("lds_status",e.target.value),className:`form-input-apple ${f.lds_status?"border-danger":""}`,disabled:x&&"已經持有"===y.voucher_application_status,required:x,children:[s.jsx("option",{value:"",children:"請選擇 LDS 狀態"}),s.jsx("option",{value:"已完成評估",children:"已完成評估"}),s.jsx("option",{value:"已經持有",children:"已經持有"}),s.jsx("option",{value:"待社工評估",children:"待社工評估"})]}),x&&"已經持有"===y.voucher_application_status&&s.jsx("p",{className:"text-apple-caption text-text-secondary mt-1",children:"已自動設為「已經持有」"}),f.lds_status&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.lds_status})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-caption font-medium text-text-primary mb-2",children:["家訪狀況 ",x&&s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("select",{value:y.home_visit_status||"",onChange:e=>q("home_visit_status",e.target.value),className:`form-input-apple ${f.home_visit_status?"border-danger":""}`,required:x,children:[s.jsx("option",{value:"",children:"請選擇家訪狀況"}),s.jsx("option",{value:"已完成",children:"已完成"}),s.jsx("option",{value:"未完成",children:"未完成"})]}),f.home_visit_status&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.home_visit_status})]})]}),(!x||"已經持有"===y.voucher_application_status)&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-caption font-medium text-text-primary mb-2",children:["社區券號碼 ",x&&s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx("input",{type:"text",value:y.voucher_number||"",onChange:e=>q("voucher_number",e.target.value),className:`form-input-apple ${f.voucher_number?"border-danger":""}`,placeholder:"請輸入社區券號碼",required:x}),f.voucher_number&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.voucher_number})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-caption font-medium text-text-primary mb-2",children:["自付額 ",x&&s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("select",{value:y.copay_level||"",onChange:e=>q("copay_level",e.target.value),className:`form-input-apple ${f.copay_level?"border-danger":""}`,required:x,children:[s.jsx("option",{value:"",children:"請選擇自付額"}),s.jsx("option",{value:"5%",children:"5%"}),s.jsx("option",{value:"8%",children:"8%"}),s.jsx("option",{value:"12%",children:"12%"}),s.jsx("option",{value:"16%",children:"16%"}),s.jsx("option",{value:"25%",children:"25%"}),s.jsx("option",{value:"40%",children:"40%"})]}),f.copay_level&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.copay_level})]})]}),(!x||"5%"===y.copay_level)&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-caption font-medium text-text-primary mb-2",children:["慈善補助 ",x&&"5%"===y.copay_level&&s.jsx("span",{className:"text-danger",children:"*"})]}),(0,s.jsxs)("div",{className:"flex space-x-4 mt-2",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",name:"charity_support",value:"true",checked:!0===y.charity_support,onChange:e=>q("charity_support","true"===e.target.value),className:"w-4 h-4 text-mingcare-blue focus:ring-mingcare-blue"}),s.jsx("span",{className:"ml-2 text-apple-caption",children:"是"})]}),(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"radio",name:"charity_support",value:"false",checked:!1===y.charity_support,onChange:e=>q("charity_support","false"===e.target.value),className:"w-4 h-4 text-mingcare-blue focus:ring-mingcare-blue"}),s.jsx("span",{className:"ml-2 text-apple-caption",children:"否"})]})]}),f.charity_support&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.charity_support})]})]})]})]})]})}),s.jsx("div",{className:"card-apple fade-in-apple",children:(0,s.jsxs)("div",{className:"card-apple-content",children:[s.jsx("h2",{className:"text-apple-heading text-text-primary mb-6",children:"個人資訊"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:["客戶姓名 ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx("input",{type:"text",value:y.customer_name||"",onChange:e=>q("customer_name",e.target.value),className:`form-input-apple ${f.customer_name?"border-danger":""}`,placeholder:"請輸入客戶姓名",required:!0}),f.customer_name&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.customer_name})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"電話號碼"}),s.jsx("input",{type:"tel",value:y.phone||"",onChange:e=>q("phone",e.target.value),className:"form-input-apple",placeholder:"請輸入電話號碼"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsxs)("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:["服務地址 ",s.jsx("span",{className:"text-danger",children:"*"})]}),s.jsx("input",{type:"text",value:y.service_address||"",onChange:e=>q("service_address",e.target.value),className:`form-input-apple ${f.service_address?"border-danger":""}`,placeholder:"請輸入完整服務地址",required:!0}),f.service_address&&s.jsx("p",{className:"text-apple-caption text-danger mt-1",children:f.service_address})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"地區"}),(0,s.jsxs)("select",{value:y.district||"",onChange:e=>q("district",e.target.value),className:"form-input-apple",children:[s.jsx("option",{value:"",children:"請選擇地區"}),s.jsx("option",{value:"中西區",children:"中西區"}),s.jsx("option",{value:"九龍城區",children:"九龍城區"}),s.jsx("option",{value:"元朗區",children:"元朗區"}),s.jsx("option",{value:"北區",children:"北區"}),s.jsx("option",{value:"南區",children:"南區"}),s.jsx("option",{value:"大埔區",children:"大埔區"}),s.jsx("option",{value:"屯門區",children:"屯門區"}),s.jsx("option",{value:"東區",children:"東區"}),s.jsx("option",{value:"沙田區",children:"沙田區"}),s.jsx("option",{value:"油尖旺區",children:"油尖旺區"}),s.jsx("option",{value:"深水埗區",children:"深水埗區"}),s.jsx("option",{value:"灣仔區",children:"灣仔區"}),s.jsx("option",{value:"荃灣區",children:"荃灣區"}),s.jsx("option",{value:"葵青區",children:"葵青區"}),s.jsx("option",{value:"西貢區",children:"西貢區"}),s.jsx("option",{value:"觀塘區",children:"觀塘區"}),s.jsx("option",{value:"離島區",children:"離島區"}),s.jsx("option",{value:"黃大仙區",children:"黃大仙區"}),s.jsx("option",{value:"未分類（醫院,院舍)",children:"未分類（醫院,院舍)"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"身份證號碼"}),s.jsx("input",{type:"text",value:y.hkid||"",onChange:e=>q("hkid",e.target.value),className:"form-input-apple",placeholder:"請輸入身份證號碼"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"出生日期"}),s.jsx("input",{type:"date",value:y.dob||"",onChange:e=>q("dob",e.target.value),className:"form-input-apple"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"年齡"}),s.jsx("input",{type:"number",value:y.age||"",readOnly:!0,className:"form-input-apple bg-bg-secondary",placeholder:"系統自動計算"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"健康狀況"}),(0,s.jsxs)("select",{value:y.health_status||"",onChange:e=>q("health_status",e.target.value),className:"form-input-apple",children:[s.jsx("option",{value:"",children:"請選擇健康狀況"}),s.jsx("option",{value:"良好",children:"良好"}),s.jsx("option",{value:"中風",children:"中風"}),s.jsx("option",{value:"需協助",children:"需協助"}),s.jsx("option",{value:"長期病患",children:"長期病患"}),s.jsx("option",{value:"認知障礙",children:"認知障礙"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-apple-body font-medium text-text-primary mb-2",children:"負責職員"}),(0,s.jsxs)("select",{value:y.staff_owner||"",onChange:e=>q("staff_owner",e.target.value),className:"form-input-apple",children:[s.jsx("option",{value:"",children:"請選擇負責職員"}),s.jsx("option",{value:"Kanas Leung",children:"Kanas Leung"}),s.jsx("option",{value:"Joe Cheung",children:"Joe Cheung"}),s.jsx("option",{value:"Candy Ho",children:"Candy Ho"})]})]})]})]})}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("button",{type:"button",onClick:S,className:"btn-apple-danger",children:"刪除客戶"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[s.jsx("button",{type:"button",onClick:()=>w.push("/clients"),className:"btn-apple-secondary",children:"取消"}),s.jsx("button",{type:"submit",disabled:c,className:"btn-apple-primary",children:c?(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"保存中..."]}):"保存變更"})]})]})]})})]})}},5442:(e,t,a)=>{"use strict";a.d(t,{O:()=>s});let s=(0,a(5623).AY)("https://cvkxlvdicympakfecgvv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3hsdmRpY3ltcGFrZmVjZ3Z2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0MjkxODEsImV4cCI6MjA2NzAwNTE4MX0.jp2fPKcBcG4-042UoN3OieR553WAgABhJIujiDJAt-I")},9741:(e,t,a)=>{"use strict";a.d(t,{n:()=>r});var s=a(5442);class r{static isUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static async queryBySmartId(e,t){let a=this.isUUID(e),r=a?"id":"customer_id";return console.log(`Using ${r} query for ${a?"UUID":"customer number"}:`,e),t(s.O.from("customer_personal_data"),r)}static async generateNextCustomerId(e,t){try{let{data:a,error:r}=await s.O.rpc("generate_next_customer_id",{p_customer_type:e,p_introducer:t||null});if(r)throw console.error("RPC 錯誤:",r),Error(`生成客戶編號失敗: ${r.message}`);if(!a)throw Error("RPC 未返回編號");return a}catch(e){throw console.error("生成客戶編號失敗:",e),Error(`生成客戶編號失敗: ${e.message||"未知錯誤"}`)}}static async getSearchSuggestions(e){try{if(e.query.length<2)return{data:[],error:"請輸入至少 2 個字元後再搜尋"};let t=e.query.trim(),a=e.limit||10,{data:r,error:i}=await s.O.from("customer_personal_data").select("id, customer_id, customer_name, phone").or(`customer_name.ilike.%${t}%,phone.ilike.%${t}%,customer_id.ilike.%${t}%`).order("created_at",{ascending:!1}).limit(a);if(i)throw i;return{data:(r||[]).map(e=>({id:e.id,customer_id:e.customer_id,customer_name:e.customer_name,phone:e.phone,display_text:`${e.customer_name} - ${e.phone}${e.customer_id?` - ${e.customer_id}`:" - 未分配編號"}`}))}}catch(e){return{data:[],error:"搜尋建議載入失敗",message:e.message}}}static async getCustomers(e,t=1,a=20){try{let r=s.O.from("customer_personal_data").select(`
          id,
          customer_id,
          customer_name,
          phone,
          district,
          service_address,
          project_manager,
          created_at,
          customer_type,
          voucher_application_status,
          lds_status,
          home_visit_status,
          copay_level
        `,{count:"exact"});e?.customer_type&&(r=r.eq("customer_type",e.customer_type)),e?.district&&(r=r.eq("district",e.district)),e?.introducer&&(r=r.eq("introducer",e.introducer)),e?.project_manager&&(r=r.eq("project_manager",e.project_manager)),e?.search&&(r=r.or(`customer_name.ilike.%${e.search}%,phone.ilike.%${e.search}%,customer_id.ilike.%${e.search}%`));let i=(t-1)*a;r=(r=r.range(i,i+a-1)).order("created_at",{ascending:!1});let{data:l,error:n,count:o}=await r;if(n)throw n;return{data:l||[],count:o||0,page:t,pageSize:a,totalPages:Math.ceil((o||0)/a)}}catch(e){return console.error("獲取客戶列表失敗:",e),{data:[],count:0,page:t,pageSize:a,totalPages:0}}}static async getCustomerById(e){try{console.log("Fetching customer with ID:",e);let{data:t,error:a}=await this.queryBySmartId(e,(t,a)=>t.select("*").eq(a,e).single());if(a&&"PGRST116"===a.code){console.log("First query failed, trying alternative method...");let t=this.isUUID(e),a=await s.O.from("customer_personal_data").select("*").eq(t?"customer_id":"id",e).single();if(a.error)throw console.error("Database error:",a.error),a.error;return console.log("Customer data found via alternative method:",a.data),{data:a.data||void 0}}if(a)throw console.error("Database error:",a),a;return console.log("Customer data found:",t),{data:t||void 0}}catch(e){return console.error("Service error:",e),{error:"客戶資料載入失敗",message:e.message}}}static async createCustomer(e){try{let t=await this.generateNextCustomerId(e.customer_type,e.introducer),a={customer_id:t,customer_type:e.customer_type,customer_name:e.customer_name,service_address:e.service_address,charity_support:e.charity_support||!1,phone:e.phone||null,hkid:e.hkid||null,dob:e.dob||null,age:e.age||null,district:e.district||null,health_status:e.health_status||null,introducer:e.introducer||null,voucher_application_status:e.voucher_application_status||null,lds_status:e.lds_status||null,home_visit_status:e.home_visit_status||null,project_manager:e.staff_owner||null,copay_level:e.copay_level||null,voucher_number:e.voucher_number||null,created_at:new Date().toISOString()},{error:r}=await s.O.from("customer_personal_data").insert([a]);if(r)throw console.error("Supabase 插入錯誤:",r),Error(r.message);return{success:!0,customer_id:t}}catch(e){return console.error("新增客戶失敗:",e),{success:!1,error:e.message||"新增客戶失敗"}}}static async updateCustomer(e,t){try{if(t.dob){let e=new Date(t.dob),a=new Date;t.age=a.getFullYear()-e.getFullYear();let s=a.getMonth()-e.getMonth();(s<0||0===s&&a.getDate()<e.getDate())&&t.age--}let a=await this.queryBySmartId(e,(a,s)=>a.update(t).eq(s,e).select().single());if(a.error)throw a.error;return{data:a.data||void 0}}catch(e){return{error:"客戶資料更新失敗",message:e.message}}}static async deleteCustomer(e){try{let t=await this.queryBySmartId(e,(t,a)=>t.delete().eq(a,e));if(t.error)throw t.error;return{}}catch(e){return{error:"客戶刪除失敗",message:e.message}}}static validateCustomerData(e){let t={};return e.customer_name?.trim()||(t.customer_name="客戶姓名為必填欄位"),e.phone?.trim()||(t.phone="電話為必填欄位"),e.district?.trim()||(t.district="地區為必填欄位"),e.service_address?.trim()||(t.service_address="服務地址為必填欄位"),e.hkid?.trim()||(t.hkid="身份證號碼為必填欄位"),e.dob?.trim()||(t.dob="出生日期為必填欄位"),e.health_status?.trim()||(t.health_status="身體狀況為必填欄位"),e.introducer?.trim()||(t.introducer="介紹人為必填欄位"),e.project_manager?.trim()||(t.project_manager="項目經理為必填欄位"),e.phone&&!/^[0-9]{8}$/.test(e.phone)&&(t.phone="電話格式錯誤，請輸入 8 位數字"),e.hkid&&!/^[A-Z]{1,2}[0-9]{6}([0-9A])$/.test(e.hkid)&&(t.hkid="HKID 格式錯誤"),e.dob&&new Date(e.dob)>new Date&&(t.dob="出生日期不能是未來日期"),"已經持有"!==e.voucher_application_status||(e.voucher_number?.trim()||(t.voucher_number="voucher_number：只有 voucher_application_status=已經持有 時必填"),e.copay_level?.trim()||(t.copay_level="請選擇自付比例（copay_level）")),"5%"===e.copay_level&&void 0===e.charity_support&&(t.charity_support="copay_level 為 5% 時，必須選擇慈善資助（charity_support）"),{isValid:0===Object.keys(t).length,errors:t}}}},1580:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(8570).createProxy)(String.raw`/Users/joecheung/Documents/GitHub/mingcare-intranet/app/clients/[id]/edit/page.tsx#default`)},1506:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n,metadata:()=>l});var s=a(9510),r=a(5384),i=a.n(r);a(7272);let l={title:"明家居家護理服務 - Intranet",description:"明家居家護理服務內部管理系統"};function n({children:e}){return s.jsx("html",{lang:"zh-TW",children:s.jsx("body",{className:i().className,children:e})})}},4998:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var s=a(6621);let r=e=>[{type:"image/png",sizes:"987x286",url:(0,s.fillMetadataSegment)(".",e.params,"icon.png")+"?ce74063d6acc4f04"}]},7272:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[948,892,830],()=>a(8065));module.exports=s})();