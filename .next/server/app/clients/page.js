(()=>{var e={};e.id=849,e.ids=[849],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},2460:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>p,tree:()=>c}),s(5714),s(1506),s(5866);var r=s(3191),a=s(8716),n=s(7922),l=s.n(n),i=s(5231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let c=["",{children:["clients",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,5714)),"/Users/joecheung/Documents/GitHub/mingcare-intranet/app/clients/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4998))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,1506)),"/Users/joecheung/Documents/GitHub/mingcare-intranet/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,4998))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/joecheung/Documents/GitHub/mingcare-intranet/app/clients/page.tsx"],x="/clients/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/clients/page",pathname:"/clients",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7487:(e,t,s)=>{Promise.resolve().then(s.bind(s,3610))},8505:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},4555:()=>{},3610:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(326),a=s(7577),n=s(5047);s(5442);var l=s(9741),i=s(962);function o({isVisible:e,suggestions:t,onSelectSuggestion:s,onClose:n,targetRef:l}){let o=(0,a.useRef)(null),[c,d]=(0,a.useState)({top:0,left:0,width:0}),[x,m]=(0,a.useState)(!1);if(!x||!e||0===t.length)return null;let p=r.jsx("div",{ref:o,className:"fixed bg-white border border-border-light rounded-apple-lg shadow-apple-lg max-h-64 overflow-y-auto z-[9999]",style:{top:`${c.top}px`,left:`${c.left}px`,width:`${c.width}px`,minWidth:"300px"},children:t.map((e,t)=>r.jsx("div",{onClick:()=>s(e),className:"px-4 py-3 hover:bg-bg-secondary cursor-pointer border-b border-border-light last:border-b-0 transition-colors duration-150",children:r.jsx("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("div",{className:"flex items-center space-x-3",children:(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("div",{className:"font-medium text-text-primary",children:e.customer_name}),r.jsx("div",{className:"text-sm text-text-secondary",children:e.customer_id})]})}),(0,r.jsxs)("div",{className:"text-xs text-text-tertiary mt-1",children:[e.phone&&(0,r.jsxs)("span",{className:"mr-3",children:["\uD83D\uDCDE ",e.phone]}),r.jsx("span",{className:"text-xs text-text-tertiary",children:e.display_text})]})]})})},`${e.id}-${t}`))});return(0,i.createPortal)(p,document.body)}function c(){let[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!0),[c,d]=(0,a.useState)([]),[x,m]=(0,a.useState)("card"),[p,u]=(0,a.useState)({}),[h,g]=(0,a.useState)(""),[j,v]=(0,a.useState)([]),[y,b]=(0,a.useState)(!1),[f,N]=(0,a.useState)(0),[_,w]=(0,a.useState)(1),[k]=(0,a.useState)(20),[C,M]=(0,a.useState)(null),L=(0,a.useRef)(null),D=(0,n.useRouter)(),S=async()=>{try{let e=await l.n.getCustomers(p,_,k);d(e.data),N(e.count)}catch(e){console.error("載入客戶列表失敗:",e)}},$=async e=>{g(e),C&&clearTimeout(C),e.length>=2?M(setTimeout(async()=>{try{let t=await l.n.getSearchSuggestions({query:e,limit:8});t.data&&(v(t.data),b(!0))}catch(e){console.error("搜尋建議失敗:",e)}},300)):(v([]),b(!1))},I=async e=>{let t=e||h;if(t.trim()){let e={...p,search:t.trim()};u(e),w(1);try{let t=await l.n.getCustomers(e,1,k);d(t.data),N(t.count)}catch(e){console.error("搜尋失敗:",e)}}},q=e=>{w(e)},P=Math.ceil(f/k),z=Math.min(_*k,f);return s?r.jsx("div",{className:"min-h-screen flex items-center justify-center",children:r.jsx("div",{className:"text-lg",children:"載入中..."})}):(0,r.jsxs)("div",{className:"min-h-screen bg-bg-primary",children:[r.jsx("header",{className:"card-apple border-b border-border-light fade-in-apple",children:r.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-4 sm:py-6 lg:py-8 space-y-4 sm:space-y-0",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-text-primary mb-1 sm:mb-2",children:"客戶管理中心"}),r.jsx("p",{className:"text-sm sm:text-base text-text-secondary",children:"管理所有客戶資料、聯絡信息及服務記錄"})]}),r.jsx("button",{onClick:()=>D.push("/dashboard"),className:"btn-apple-secondary text-xs sm:text-sm self-start sm:self-auto",children:"返回主頁"})]})})}),(0,r.jsxs)("main",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 lg:py-8",children:[(0,r.jsxs)("div",{className:"card-apple mb-4 sm:mb-6 fade-in-apple",children:[r.jsx("div",{className:"card-apple-header",children:r.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-text-primary",children:"搜尋與篩選"})}),(0,r.jsxs)("div",{className:"card-apple-content",children:[(0,r.jsxs)("div",{className:"mb-4 sm:mb-6 relative",style:{zIndex:1e4},children:[(0,r.jsxs)("div",{className:"relative",children:[r.jsx("input",{ref:L,type:"text",value:h,onChange:e=>$(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),I(),b(!1)):"Escape"===e.key&&b(!1)},onFocus:()=>{j.length>0&&b(!0)},placeholder:"搜尋客戶姓名、電話或項目編號...",className:"w-full pl-10 sm:pl-12 pr-20 sm:pr-24 py-2 sm:py-3 bg-bg-secondary border-transparent focus:bg-white focus:border-mingcare-blue focus:shadow-apple-focus rounded-apple-sm text-sm transition-all duration-200"}),r.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none",children:r.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,r.jsxs)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 sm:pr-3 space-x-1 sm:space-x-2",children:[h&&r.jsx("button",{onClick:()=>{g("");let e={...p};delete e.search,u(e),w(1),S()},className:"text-text-tertiary hover:text-text-secondary transition-colors p-1",type:"button",children:r.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsxs)("button",{onClick:()=>I(),className:"btn-apple-primary py-1 px-2 sm:px-3 text-xs",type:"button",children:[r.jsx("span",{className:"hidden sm:inline",children:"搜尋"}),r.jsx("span",{className:"sm:hidden",children:r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]})]}),r.jsx(o,{isVisible:y,suggestions:j,onSelectSuggestion:e=>{g(e.customer_name),b(!1),I(e.customer_name)},onClose:()=>b(!1),targetRef:L})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-4 sm:gap-4",children:[(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsxs)("label",{className:"block text-xs font-medium text-text-primary mb-1 flex items-center",children:[r.jsx("svg",{className:"w-3 h-3 mr-1 text-blue-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),r.jsx("span",{className:"truncate",children:"客戶類型"})]}),(0,r.jsxs)("select",{value:p.customer_type||"",onChange:e=>{let t={...p};e.target.value?t.customer_type=e.target.value:delete t.customer_type,u(t),w(1)},className:"w-full text-xs bg-gray-50 border border-gray-200 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",children:[r.jsx("option",{value:"",children:"全部"}),r.jsx("option",{value:"社區券客戶",children:"社區券"}),r.jsx("option",{value:"明家街客",children:"明家街客"})]})]}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsxs)("label",{className:"block text-xs font-medium text-text-primary mb-1 flex items-center",children:[(0,r.jsxs)("svg",{className:"w-3 h-3 mr-1 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),r.jsx("span",{className:"truncate",children:"地區"})]}),(0,r.jsxs)("select",{value:p.district||"",onChange:e=>{let t={...p};e.target.value?t.district=e.target.value:delete t.district,u(t),w(1)},className:"w-full text-xs bg-gray-50 border border-gray-200 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all",children:[r.jsx("option",{value:"",children:"全部"}),r.jsx("option",{value:"中西區",children:"中西區"}),r.jsx("option",{value:"灣仔區",children:"灣仔區"}),r.jsx("option",{value:"東區",children:"東區"}),r.jsx("option",{value:"南區",children:"南區"}),r.jsx("option",{value:"深水埗區",children:"深水埗"}),r.jsx("option",{value:"油尖旺區",children:"油尖旺"}),r.jsx("option",{value:"九龍城區",children:"九龍城"}),r.jsx("option",{value:"黃大仙區",children:"黃大仙"}),r.jsx("option",{value:"觀塘區",children:"觀塘區"}),r.jsx("option",{value:"荃灣區",children:"荃灣區"}),r.jsx("option",{value:"屯門區",children:"屯門區"}),r.jsx("option",{value:"元朗區",children:"元朗區"}),r.jsx("option",{value:"北區",children:"北區"}),r.jsx("option",{value:"大埔區",children:"大埔區"}),r.jsx("option",{value:"沙田區",children:"沙田區"}),r.jsx("option",{value:"西貢區",children:"西貢區"}),r.jsx("option",{value:"葵青區",children:"葵青區"}),r.jsx("option",{value:"離島區",children:"離島區"})]})]}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsxs)("label",{className:"block text-xs font-medium text-text-primary mb-1 flex items-center",children:[r.jsx("svg",{className:"w-3 h-3 mr-1 text-purple-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),r.jsx("span",{className:"truncate",children:"介紹人"})]}),(0,r.jsxs)("select",{value:p.introducer||"",onChange:e=>{let t={...p};e.target.value?t.introducer=e.target.value:delete t.introducer,u(t),w(1)},className:"w-full text-xs bg-gray-50 border border-gray-200 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all",children:[r.jsx("option",{value:"",children:"全部"}),r.jsx("option",{value:"Kanas Leung",children:"Kanas"}),r.jsx("option",{value:"Joe Cheung",children:"Joe"}),r.jsx("option",{value:"Candy Ho",children:"Candy"}),r.jsx("option",{value:"Steven Kwok",children:"Steven"}),r.jsx("option",{value:"Dr.Lee",children:"Dr.Lee"}),r.jsx("option",{value:"Annie",children:"Annie"}),r.jsx("option",{value:"Janet",children:"Janet"}),r.jsx("option",{value:"陸sir",children:"陸sir"}),r.jsx("option",{value:"吳翹政",children:"吳翹政"}),r.jsx("option",{value:"余翠英",children:"余翠英"}),r.jsx("option",{value:"陳小姐MC01",children:"陳小姐"}),r.jsx("option",{value:"曾先生",children:"曾先生"})]})]}),(0,r.jsxs)("div",{className:"min-w-0",children:[(0,r.jsxs)("label",{className:"block text-xs font-medium text-text-primary mb-1 flex items-center",children:[r.jsx("svg",{className:"w-3 h-3 mr-1 text-orange-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m8 6V8a2 2 0 00-2-2H6a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2z"})}),r.jsx("span",{className:"truncate",children:"負責同事"})]}),(0,r.jsxs)("select",{value:p.project_manager||"",onChange:e=>{let t={...p};e.target.value?t.project_manager=e.target.value:delete t.project_manager,u(t),w(1)},className:"w-full text-xs bg-gray-50 border border-gray-200 rounded-lg px-2 py-1.5 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all",children:[r.jsx("option",{value:"",children:"全部"}),r.jsx("option",{value:"Kanas Leung",children:"Kanas"}),r.jsx("option",{value:"Joe Cheung",children:"Joe"}),r.jsx("option",{value:"Candy Ho",children:"Candy"})]})]})]}),(Object.keys(p).length>0||h.trim())&&r.jsx("div",{className:"mt-3 flex justify-center",children:(0,r.jsxs)("button",{onClick:async()=>{u({}),w(1),g(""),b(!1);try{i(!0);let{data:e,count:t}=await l.n.getCustomers({},1,k);d(e),N(t)}catch(e){console.error("重新載入客戶列表失敗:",e)}finally{i(!1)}},className:"text-xs bg-red-50 hover:bg-red-100 text-red-600 px-3 py-1.5 rounded-lg flex items-center space-x-1 transition-all border border-red-200 hover:border-red-300",children:[r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),r.jsx("span",{children:"清除篩選"})]})})]})]}),r.jsx("div",{className:"card-apple mb-4 fade-in-apple",style:{animationDelay:"0.2s"},children:r.jsx("div",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,r.jsxs)("span",{className:"text-sm text-text-primary",children:["共 ",r.jsx("span",{className:"font-semibold text-mingcare-blue",children:f})," 位客戶"]}),Object.keys(p).length>0&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("span",{className:"text-xs text-text-secondary",children:"篩選:"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1",children:[p.customer_type&&r.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs",children:p.customer_type}),p.district&&r.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs",children:p.district}),p.introducer&&r.jsx("span",{className:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs",children:p.introducer}),p.project_manager&&r.jsx("span",{className:"px-2 py-0.5 bg-orange-100 text-orange-700 rounded text-xs",children:p.project_manager}),p.search&&(0,r.jsxs)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 rounded text-xs",children:["搜尋: ",p.search]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[(0,r.jsxs)("button",{onClick:()=>D.push("/clients/new"),className:"text-xs sm:text-sm bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-lg flex items-center space-x-1 transition-all",children:[r.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),r.jsx("span",{className:"hidden sm:inline",children:"新增客戶"}),r.jsx("span",{className:"sm:hidden",children:"新增"})]}),(0,r.jsxs)("div",{className:"flex rounded-lg border border-gray-200 p-0.5 bg-gray-50",children:[r.jsx("button",{onClick:()=>m("card"),className:`px-2 py-1 text-xs font-medium rounded transition-all duration-200 ${"card"===x?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),r.jsx("span",{className:"hidden sm:inline",children:"卡片"})]})}),r.jsx("button",{onClick:()=>m("list"),className:`px-2 py-1 text-xs font-medium rounded transition-all duration-200 ${"list"===x?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[r.jsx("svg",{className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),r.jsx("span",{className:"hidden sm:inline",children:"列表"})]})})]})]})]})})}),r.jsx("div",{className:"card-apple fade-in-apple",style:{animationDelay:"0.3s"},children:r.jsx("div",{className:"card-apple-content",children:0===c.length?(0,r.jsxs)("div",{className:"text-center py-16",children:[r.jsx("svg",{className:"mx-auto h-16 w-16 text-text-tertiary mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),r.jsx("h3",{className:"text-apple-heading text-text-primary mb-2",children:Object.keys(p).length>0?"沒有符合條件的客戶":"暫無客戶資料"}),r.jsx("p",{className:"text-apple-body text-text-secondary mb-6 max-w-md mx-auto",children:Object.keys(p).length>0?"嘗試調整搜尋條件或篩選器以找到您需要的客戶":"開始新增客戶以建立您的客戶資料庫"}),(0,r.jsxs)("button",{type:"button",onClick:()=>D.push("/clients/new"),className:"btn-apple-primary",children:[r.jsx("svg",{className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"新增客戶"]})]}):r.jsx(r.Fragment,{children:"card"===x?r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-6",children:c.map((e,t)=>(0,r.jsxs)("div",{className:"group cursor-pointer transition-all duration-500 hover:shadow-2xl hover:scale-105 hover:-translate-y-2 relative overflow-hidden transform hover:rotate-1 card-hover-float pulse-glow rounded-2xl md:rounded-3xl border-2 border-gray-100 hover:border-transparent bg-white shadow-lg",style:{animationDelay:`${.4+.05*t}s`},onClick:()=>D.push(`/clients/${e.customer_id||e.id}/edit`),children:[r.jsx("div",{className:`px-3 py-2 md:px-4 md:py-3 text-white font-medium text-xs md:text-sm rounded-t-2xl md:rounded-t-3xl ${"社區券客戶"===e.customer_type?"bg-gradient-to-r from-green-500 to-green-600":"bg-gradient-to-r from-blue-500 to-blue-600"}`,children:r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("span",{children:e.customer_type})})}),(0,r.jsxs)("div",{className:"p-3 md:p-6 bg-white rounded-b-2xl md:rounded-b-3xl relative z-10",children:[r.jsx("div",{className:"flex justify-between items-start mb-2 md:mb-4",children:(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-base md:text-xl font-bold text-gray-900 truncate mb-1 group-hover:text-gray-700 transition-colors duration-300",children:e.customer_name}),r.jsx("p",{className:"text-xs md:text-sm text-gray-500 group-hover:text-gray-400 transition-colors duration-300",children:e.customer_id||"未分配編號"})]})}),(0,r.jsxs)("div",{className:"space-y-2 md:space-y-3 mb-2 md:mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center text-xs md:text-apple-caption text-text-secondary",children:[r.jsx("svg",{className:"h-3 w-3 md:h-4 md:w-4 mr-2 md:mr-3 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.phone]}),(0,r.jsxs)("div",{className:"flex items-start text-xs md:text-apple-caption text-text-secondary",children:[(0,r.jsxs)("svg",{className:"h-3 w-3 md:h-4 md:w-4 mr-2 md:mr-3 mt-0.5 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),r.jsx("span",{className:"line-clamp-2",children:e.service_address})]})]}),(0,r.jsxs)("div",{className:"space-y-1.5 md:space-y-2 mb-2 md:mb-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-1.5 md:gap-2",children:[e.voucher_application_status&&(0,r.jsxs)("div",{className:"text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary block mb-0.5 md:mb-1 text-xs",children:"社區券："}),r.jsx("span",{className:`px-1.5 py-0.5 md:px-2 md:py-1 rounded-full text-xs w-full text-center block ${"已經持有"===e.voucher_application_status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:e.voucher_application_status})]}),e.lds_status&&(0,r.jsxs)("div",{className:"text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary block mb-0.5 md:mb-1 text-xs",children:"LDS："}),r.jsx("span",{className:`px-1.5 py-0.5 md:px-2 md:py-1 rounded-full text-xs w-full text-center block ${"已完成評估"===e.lds_status||"已經持有"===e.lds_status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:e.lds_status})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-1.5 md:gap-2",children:[e.home_visit_status&&(0,r.jsxs)("div",{className:"text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary block mb-0.5 md:mb-1 text-xs",children:"家訪："}),r.jsx("span",{className:`px-1.5 py-0.5 md:px-2 md:py-1 rounded-full text-xs w-full text-center block ${"已完成"===e.home_visit_status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.home_visit_status})]}),e.copay_level&&(0,r.jsxs)("div",{className:"text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary block mb-0.5 md:mb-1 text-xs",children:"自付："}),r.jsx("span",{className:"px-1.5 py-0.5 md:px-2 md:py-1 rounded-full text-xs bg-purple-100 text-purple-800 w-full text-center block",children:e.copay_level})]})]})]}),r.jsx("div",{className:"pt-2 md:pt-4 border-t border-border-light text-right",children:r.jsx("span",{className:"text-xs text-text-tertiary",children:new Date(e.created_at).toLocaleDateString("zh-TW")})})]})]},e.id))}):r.jsx("div",{className:"overflow-hidden rounded-apple-sm border border-border-light",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-border-light",children:[r.jsx("thead",{className:"bg-bg-tertiary",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-text-primary uppercase tracking-wider",children:"客戶資料"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-text-primary uppercase tracking-wider",children:"聯絡資訊"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-text-primary uppercase tracking-wider",children:"服務地址"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-text-primary uppercase tracking-wider",children:"類型"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-text-primary uppercase tracking-wider",children:"狀態資訊"}),r.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-text-primary uppercase tracking-wider",children:"建立日期"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-border-light",children:c.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-bg-tertiary transition-colors cursor-pointer",onClick:()=>D.push(`/clients/${e.customer_id||e.id}/edit`),children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-1 h-8 rounded-full mr-3 ${"社區券客戶"===e.customer_type?"bg-green-500":"bg-blue-500"}`}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-apple-body text-text-primary font-medium",children:e.customer_name}),r.jsx("div",{className:"text-apple-caption text-text-secondary",children:e.customer_id||"未分配編號"})]})]})}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("div",{className:"text-apple-caption text-text-primary",children:e.phone})}),r.jsx("td",{className:"px-6 py-4",children:r.jsx("div",{className:"text-apple-caption text-text-primary max-w-xs",children:r.jsx("div",{className:"line-clamp-2",children:e.service_address})})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${"社區券客戶"===e.customer_type?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:e.customer_type})}),r.jsx("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"space-y-1",children:[e.voucher_application_status&&(0,r.jsxs)("div",{className:"flex items-center text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary mr-1",children:"社區券："}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${"已經持有"===e.voucher_application_status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:e.voucher_application_status})]}),e.lds_status&&(0,r.jsxs)("div",{className:"flex items-center text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary mr-1",children:"LDS："}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${"已完成評估"===e.lds_status||"已經持有"===e.lds_status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:e.lds_status})]}),e.home_visit_status&&(0,r.jsxs)("div",{className:"flex items-center text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary mr-1",children:"家訪："}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${"已完成"===e.home_visit_status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.home_visit_status})]}),e.copay_level&&(0,r.jsxs)("div",{className:"flex items-center text-xs",children:[r.jsx("span",{className:"font-medium text-text-primary mr-1",children:"自付："}),r.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-800",children:e.copay_level})]})]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:new Date(e.created_at).toLocaleDateString("zh-TW")})]},e.id))})]})})})})}),c.length>0&&r.jsx("div",{className:"card-apple fade-in-apple",style:{animationDelay:"0.4s"},children:(0,r.jsxs)("div",{className:"card-apple-content flex flex-col sm:flex-row justify-between items-center py-6",children:[(0,r.jsxs)("div",{className:"text-apple-caption text-text-secondary mb-4 sm:mb-0",children:["顯示第 ",r.jsx("span",{className:"font-medium",children:(_-1)*k+1})," 到 ",r.jsx("span",{className:"font-medium",children:z})," 項， 共 ",r.jsx("span",{className:"font-medium",children:f})," 項結果"]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:()=>q(_-1),disabled:_<=1,className:"btn-apple-secondary px-3 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:r.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),r.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,P)},(e,t)=>{let s;return s=P<=5?t+1:_<=3?t+1:_>=P-2?P-4+t:_-2+t,r.jsx("button",{onClick:()=>q(s),className:s===_?"btn-apple-primary px-3 py-2 text-sm":"btn-apple-secondary px-3 py-2 text-sm",children:s},s)})}),r.jsx("button",{onClick:()=>q(_+1),disabled:_>=P,className:"btn-apple-secondary px-3 py-2 disabled:opacity-50 disabled:cursor-not-allowed",children:r.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})]})})]})]})}},5442:(e,t,s)=>{"use strict";s.d(t,{O:()=>r});let r=(0,s(5623).AY)("https://cvkxlvdicympakfecgvv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3hsdmRpY3ltcGFrZmVjZ3Z2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0MjkxODEsImV4cCI6MjA2NzAwNTE4MX0.jp2fPKcBcG4-042UoN3OieR553WAgABhJIujiDJAt-I")},9741:(e,t,s)=>{"use strict";s.d(t,{n:()=>a});var r=s(5442);class a{static isUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static async queryBySmartId(e,t){let s=this.isUUID(e),a=s?"id":"customer_id";return console.log(`Using ${a} query for ${s?"UUID":"customer number"}:`,e),t(r.O.from("customer_personal_data"),a)}static async generateNextCustomerId(e,t){try{let{data:s,error:a}=await r.O.rpc("generate_next_customer_id",{p_customer_type:e,p_introducer:t||null});if(a)throw console.error("RPC 錯誤:",a),Error(`生成客戶編號失敗: ${a.message}`);if(!s)throw Error("RPC 未返回編號");return s}catch(e){throw console.error("生成客戶編號失敗:",e),Error(`生成客戶編號失敗: ${e.message||"未知錯誤"}`)}}static async getSearchSuggestions(e){try{if(e.query.length<2)return{data:[],error:"請輸入至少 2 個字元後再搜尋"};let t=e.query.trim(),s=e.limit||10,{data:a,error:n}=await r.O.from("customer_personal_data").select("id, customer_id, customer_name, phone").or(`customer_name.ilike.%${t}%,phone.ilike.%${t}%,customer_id.ilike.%${t}%`).order("created_at",{ascending:!1}).limit(s);if(n)throw n;return{data:(a||[]).map(e=>({id:e.id,customer_id:e.customer_id,customer_name:e.customer_name,phone:e.phone,display_text:`${e.customer_name} - ${e.phone}${e.customer_id?` - ${e.customer_id}`:" - 未分配編號"}`}))}}catch(e){return{data:[],error:"搜尋建議載入失敗",message:e.message}}}static async getCustomers(e,t=1,s=20){try{let a=r.O.from("customer_personal_data").select(`
          id,
          customer_id,
          customer_name,
          phone,
          district,
          service_address,
          project_manager,
          created_at,
          customer_type,
          voucher_application_status,
          lds_status,
          home_visit_status,
          copay_level
        `,{count:"exact"});e?.customer_type&&(a=a.eq("customer_type",e.customer_type)),e?.district&&(a=a.eq("district",e.district)),e?.introducer&&(a=a.eq("introducer",e.introducer)),e?.project_manager&&(a=a.eq("project_manager",e.project_manager)),e?.search&&(a=a.or(`customer_name.ilike.%${e.search}%,phone.ilike.%${e.search}%,customer_id.ilike.%${e.search}%`));let n=(t-1)*s;a=(a=a.range(n,n+s-1)).order("created_at",{ascending:!1});let{data:l,error:i,count:o}=await a;if(i)throw i;return{data:l||[],count:o||0,page:t,pageSize:s,totalPages:Math.ceil((o||0)/s)}}catch(e){return console.error("獲取客戶列表失敗:",e),{data:[],count:0,page:t,pageSize:s,totalPages:0}}}static async getCustomerById(e){try{console.log("Fetching customer with ID:",e);let{data:t,error:s}=await this.queryBySmartId(e,(t,s)=>t.select("*").eq(s,e).single());if(s&&"PGRST116"===s.code){console.log("First query failed, trying alternative method...");let t=this.isUUID(e),s=await r.O.from("customer_personal_data").select("*").eq(t?"customer_id":"id",e).single();if(s.error)throw console.error("Database error:",s.error),s.error;return console.log("Customer data found via alternative method:",s.data),{data:s.data||void 0}}if(s)throw console.error("Database error:",s),s;return console.log("Customer data found:",t),{data:t||void 0}}catch(e){return console.error("Service error:",e),{error:"客戶資料載入失敗",message:e.message}}}static async createCustomer(e){try{let t=await this.generateNextCustomerId(e.customer_type,e.introducer),s={customer_id:t,customer_type:e.customer_type,customer_name:e.customer_name,service_address:e.service_address,charity_support:e.charity_support||!1,phone:e.phone||null,hkid:e.hkid||null,dob:e.dob||null,age:e.age||null,district:e.district||null,health_status:e.health_status||null,introducer:e.introducer||null,voucher_application_status:e.voucher_application_status||null,lds_status:e.lds_status||null,home_visit_status:e.home_visit_status||null,project_manager:e.staff_owner||null,copay_level:e.copay_level||null,voucher_number:e.voucher_number||null,created_at:new Date().toISOString()},{error:a}=await r.O.from("customer_personal_data").insert([s]);if(a)throw console.error("Supabase 插入錯誤:",a),Error(a.message);return{success:!0,customer_id:t}}catch(e){return console.error("新增客戶失敗:",e),{success:!1,error:e.message||"新增客戶失敗"}}}static async updateCustomer(e,t){try{if(t.dob){let e=new Date(t.dob),s=new Date;t.age=s.getFullYear()-e.getFullYear();let r=s.getMonth()-e.getMonth();(r<0||0===r&&s.getDate()<e.getDate())&&t.age--}let s=await this.queryBySmartId(e,(s,r)=>s.update(t).eq(r,e).select().single());if(s.error)throw s.error;return{data:s.data||void 0}}catch(e){return{error:"客戶資料更新失敗",message:e.message}}}static async deleteCustomer(e){try{let t=await this.queryBySmartId(e,(t,s)=>t.delete().eq(s,e));if(t.error)throw t.error;return{}}catch(e){return{error:"客戶刪除失敗",message:e.message}}}static validateCustomerData(e){let t={};return e.customer_name?.trim()||(t.customer_name="客戶姓名為必填欄位"),e.phone?.trim()||(t.phone="電話為必填欄位"),e.district?.trim()||(t.district="地區為必填欄位"),e.service_address?.trim()||(t.service_address="服務地址為必填欄位"),e.hkid?.trim()||(t.hkid="身份證號碼為必填欄位"),e.dob?.trim()||(t.dob="出生日期為必填欄位"),e.health_status?.trim()||(t.health_status="身體狀況為必填欄位"),e.introducer?.trim()||(t.introducer="介紹人為必填欄位"),e.project_manager?.trim()||(t.project_manager="項目經理為必填欄位"),e.phone&&!/^[0-9]{8}$/.test(e.phone)&&(t.phone="電話格式錯誤，請輸入 8 位數字"),e.hkid&&!/^[A-Z]{1,2}[0-9]{6}([0-9A])$/.test(e.hkid)&&(t.hkid="HKID 格式錯誤"),e.dob&&new Date(e.dob)>new Date&&(t.dob="出生日期不能是未來日期"),"已經持有"!==e.voucher_application_status||(e.voucher_number?.trim()||(t.voucher_number="voucher_number：只有 voucher_application_status=已經持有 時必填"),e.copay_level?.trim()||(t.copay_level="請選擇自付比例（copay_level）")),"5%"===e.copay_level&&void 0===e.charity_support&&(t.charity_support="copay_level 為 5% 時，必須選擇慈善資助（charity_support）"),{isValid:0===Object.keys(t).length,errors:t}}}},5714:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`/Users/joecheung/Documents/GitHub/mingcare-intranet/app/clients/page.tsx#default`)},1506:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i,metadata:()=>l});var r=s(9510),a=s(5384),n=s.n(a);s(7272);let l={title:"明家居家護理服務 - Intranet",description:"明家居家護理服務內部管理系統"};function i({children:e}){return r.jsx("html",{lang:"zh-TW",children:r.jsx("body",{className:n().className,children:e})})}},4998:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});var r=s(6621);let a=e=>[{type:"image/png",sizes:"987x286",url:(0,r.fillMetadataSegment)(".",e.params,"icon.png")+"?ce74063d6acc4f04"}]},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,892,830],()=>s(2460));module.exports=r})();