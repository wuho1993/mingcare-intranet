(()=>{var e={};e.id=461,e.ids=[461],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},5315:e=>{"use strict";e.exports=require("path")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},9515:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>c}),r(8239),r(1506),r(5866);var s=r(3191),a=r(8716),l=r(7922),i=r.n(l),n=r(5231),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);r.d(t,o);let c=["",{children:["care-staff",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,8239)),"/Users/joecheung/Documents/GitHub/mingcare-intranet/app/care-staff/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,9058))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,1506)),"/Users/joecheung/Documents/GitHub/mingcare-intranet/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,9058))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["/Users/joecheung/Documents/GitHub/mingcare-intranet/app/care-staff/page.tsx"],p="/care-staff/page",x={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/care-staff/page",pathname:"/care-staff",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3865:(e,t,r)=>{Promise.resolve().then(r.bind(r,7646))},8505:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},4555:()=>{},7646:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(326),a=r(7577),l=r(962),i=r(5047),n=r(5442);class o{static async getCareStaff(e={},t=1,r=20,s){try{let a=n.O.from("care_staff_profiles").select(`
          id,
          staff_id,
          name_chinese,
          phone,
          preferred_area,
          contract_status,
          created_at,
          job_position
        `,{count:"exact"});if(e.search){let t=`%${e.search.trim()}%`;a=a.or(`name_chinese.ilike.${t},phone.ilike.${t},staff_id.ilike.${t}`)}if(e.gender&&(a=a.eq("gender",e.gender)),e.preferred_area&&(a=a.eq("preferred_area",e.preferred_area)),e.contract_status&&(a=a.eq("contract_status",e.contract_status)),e.job_position&&(a=a.contains("job_position",[e.job_position])),e.covid_vaccine&&(a=a.eq("covid_vaccine",e.covid_vaccine)),void 0!==e.has_certificate&&(a=e.has_certificate?a.or(`
            certificate_1.not.is.null,
            certificate_2.not.is.null,
            certificate_3.not.is.null,
            certificate_4.not.is.null,
            certificate_5.not.is.null
          `):a.is("certificate_1",null).is("certificate_2",null).is("certificate_3",null).is("certificate_4",null).is("certificate_5",null)),e.language&&(a=a.contains("language",[e.language])),s){let e="asc"===s.direction;a=a.order(s.field,{ascending:e})}else a=a.order("created_at",{ascending:!1});let l=(t-1)*r;a=a.range(l,l+r-1);let{data:i,error:o,count:c}=await a;if(o)throw console.error("獲取護理人員列表失敗:",o),Error(`獲取護理人員列表失敗: ${o.message}`);return{data:i,count:c||0,total_pages:Math.ceil((c||0)/r),current_page:t,page_size:r}}catch(e){throw console.error("獲取護理人員列表失敗:",e),e}}static async getCareStaffSuggestions(e){try{let t=e.query?.trim();if(!t)return{data:[],count:0};let r=t.length,s=!1,a=[];if(r>=1){let e=`%${t}%`;a.push(`name_chinese.ilike.${e}`),s=!0}if(r>=3){let e=`%${t}%`;a.push(`staff_id.ilike.${e}`)}if(r>=4){let e=`%${t}%`;a.push(`phone.ilike.${e}`)}if(!s||0===a.length)return{data:[],count:0};let{data:l,error:i}=await n.O.from("care_staff_profiles").select("id, name_chinese, staff_id, phone").or(a.join(",")).limit(20).order("name_chinese",{ascending:!0});if(i)throw console.error("獲取搜尋建議失敗:",i),Error(`獲取搜尋建議失敗: ${i.message}`);let o=(l||[]).map(e=>{let r="name",s=t.toLowerCase(),a=e.name_chinese?.toLowerCase().includes(s),l=e.phone?.toLowerCase().includes(s),i=e.staff_id?.toLowerCase().includes(s);return[a,l,i].filter(Boolean).length>1?r="mixed":a?r="name":l?r="phone":i&&(r="staff_id"),{id:e.id,name_chinese:e.name_chinese||"",staff_id:e.staff_id,phone:e.phone,match_type:r}});return{data:o,count:o.length}}catch(e){throw console.error("獲取搜尋建議失敗:",e),e}}static async getCareStaffById(e){try{let{data:t,error:r}=await n.O.from("care_staff_profiles").select("*").eq("id",e).single();if(r){if("PGRST116"===r.code)return{data:null,error:"找不到指定的護理人員"};throw console.error("獲取護理人員詳細資料失敗:",r),Error(`獲取護理人員詳細資料失敗: ${r.message}`)}return{data:t}}catch(e){throw console.error("獲取護理人員詳細資料失敗:",e),e}}static async createCareStaff(e){try{let t=this.validateFormData(e);if(Object.keys(t).length>0)throw Error(`表單驗證失敗: ${Object.values(t).join(", ")}`);let{data:r,error:s}=await n.O.from("care_staff_profiles").insert([e]).select().single();if(s)throw console.error("新增護理人員失敗:",s),Error(`新增護理人員失敗: ${s.message}`);return{data:r}}catch(e){throw console.error("新增護理人員失敗:",e),e}}static async updateCareStaff(e,t){try{if(void 0!==t.name_chinese&&!t.name_chinese.trim())throw Error("護理人員姓名不能為空");if(void 0!==t.phone&&!t.phone.trim())throw Error("聯絡電話不能為空");let{data:r,error:s}=await n.O.from("care_staff_profiles").update(t).eq("id",e).select().single();if(s)throw console.error("更新護理人員資料失敗:",s),Error(`更新護理人員資料失敗: ${s.message}`);return{data:r}}catch(e){throw console.error("更新護理人員資料失敗:",e),e}}static async getCareStaffOptions(){try{let[e,t]=await Promise.all([n.O.from("language_options").select("*").order("id"),n.O.from("job_position_options").select("*").order("id")]);if(e.error)throw console.error("獲取語言選項失敗:",e.error),Error(`獲取語言選項失敗: ${e.error.message}`);if(t.error)throw console.error("獲取職位選項失敗:",t.error),Error(`獲取職位選項失敗: ${t.error.message}`);return{languages:e.data||[],job_positions:t.data||[]}}catch(e){throw console.error("獲取選項資料失敗:",e),e}}static async uploadCareStaffFile(e,t){try{let{field_name:r,file:s}=t,a=Date.now(),l=`${a}_${s.name}`,i=`care-staff/${e}/${r}/${l}`,{data:o,error:c}=await n.O.storage.from("care-staff-files").upload(i,s);if(c)throw console.error("檔案上載失敗:",c),Error(`檔案上載失敗: ${c.message}`);let{data:d}=n.O.storage.from("care-staff-files").getPublicUrl(o.path);return d.publicUrl}catch(e){throw console.error("檔案上載失敗:",e),e}}static async removeCareStaffFile(e){try{let t=new URL(e).pathname.split("/"),r=t.findIndex(e=>"care-staff-files"===e);if(-1===r)throw Error("無效的檔案 URL");let s=t.slice(r+1).join("/"),{error:a}=await n.O.storage.from("care-staff-files").remove([s]);if(a)throw console.error("刪除檔案失敗:",a),Error(`刪除檔案失敗: ${a.message}`)}catch(e){throw console.error("刪除檔案失敗:",e),e}}static validateFormData(e){let t={};return e.name_chinese?.trim()?e.name_chinese.trim().length<2?t.name_chinese="護理人員姓名至少需要2個字元":e.name_chinese.trim().length>50&&(t.name_chinese="護理人員姓名不能超過50個字元"):t.name_chinese="護理人員姓名為必填欄位",e.phone?.trim()?/^[2-9]\d{7}$|^[569]\d{7}$/.test(e.phone.replace(/\s+/g,""))||(t.phone="請輸入有效的香港電話號碼"):t.phone="聯絡電話為必填欄位",e.email&&e.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email.trim())&&(t.email="請輸入有效的電郵地址"),e.hkid&&e.hkid.trim()&&!/^[A-Z]{1,2}[0-9]{6}\([0-9A]\)$/.test(e.hkid.trim().toUpperCase())&&(t.hkid="請輸入有效的香港身份證號碼格式 (例：A123456(7))"),e.experience_years&&e.experience_years.trim()&&!/^\d+(\.\d+)?$/.test(e.experience_years.trim())&&(t.experience_years="年資請輸入數字格式 (例：2 或 2.5)"),t}static async deleteCareStaff(e){try{let{error:t}=await n.O.from("care_staff_profiles").delete().eq("id",e);if(t)return console.error("刪除護理人員失敗:",t),{success:!1,error:`刪除護理人員失敗: ${t.message}`};return{success:!0}}catch(e){return console.error("刪除護理人員失敗:",e),{success:!1,error:"刪除護理人員時發生錯誤，請稍後再試"}}}}class c{static{this.BUCKET_NAME="care-staff-files"}static{this.MAX_FILE_SIZE=10485760}static{this.ALLOWED_TYPES=["image/jpeg","image/png","application/pdf"]}static{this.ALLOWED_EXTENSIONS=[".jpg",".jpeg",".png",".pdf"]}static validateFile(e){if(e.size>this.MAX_FILE_SIZE)return{valid:!1,error:"檔案太大，請選擇小於 10MB"};let t=e.name.toLowerCase(),r=this.ALLOWED_EXTENSIONS.some(e=>t.endsWith(e)),s=this.ALLOWED_TYPES.includes(e.type);return r&&s?{valid:!0}:{valid:!1,error:"不支援的格式（僅限 JPG/PNG/PDF）"}}static generateFilePath(e,t,r){let s=new Date().toISOString().replace(/[-:.]/g,"").slice(0,15),a=r.substring(r.lastIndexOf("."));return`care-staff/${e}/${e}_${t}_${s}${a}`}static async uploadFile(e,t,r,s){try{let a=this.validateFile(e);if(!a.valid)return{success:!1,error:a.error};let l=this.generateFilePath(t,r,e.name);s?.({progress:0,status:"uploading"});let{data:i,error:o}=await n.O.storage.from(this.BUCKET_NAME).upload(l,e,{cacheControl:"3600",upsert:!1});if(o)return console.error("Storage upload error:",o),s?.({progress:0,status:"error",error:"上載失敗，請稍後再試"}),{success:!1,error:"上載失敗，請稍後再試"};let{data:{publicUrl:c}}=n.O.storage.from(this.BUCKET_NAME).getPublicUrl(l);return s?.({progress:100,status:"success",url:c}),{success:!0,url:c}}catch(t){console.error("File upload error:",t);let e="上載失敗，請稍後再試";return s?.({progress:0,status:"error",error:e}),{success:!1,error:e}}}static async deleteFile(e){try{let{error:t}=await n.O.storage.from(this.BUCKET_NAME).remove([e]);if(t)return console.error("Storage delete error:",t),{success:!1,error:"刪除檔案失敗"};return{success:!0}}catch(e){return console.error("File delete error:",e),{success:!1,error:"刪除檔案失敗"}}}static extractFilePathFromUrl(e){try{let t=new URL(e).pathname.split("/"),r=t.findIndex(e=>"object"===e);if(-1!==r&&"public"===t[r+1])return t.slice(r+3).join("/");return null}catch{return null}}static async replaceFile(e,t,r,s,a){try{let l=await this.uploadFile(e,t,r,a);if(!l.success)return l;let i=this.extractFilePathFromUrl(s);return i&&await this.deleteFile(i),l}catch(e){return console.error("File replace error:",e),{success:!1,error:"替換檔案失敗"}}}}function d({label:e,fieldName:t,staffId:r,currentUrl:l,onUploadSuccess:i,onRemove:o,disabled:d=!1}){let[p,x]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),u=(0,a.useRef)(null),f=p?.status==="uploading",g=!!l,j=async e=>{let s=e.target.files?.[0];if(s)try{let e=await c.uploadFile(s,r,t,x);e.success&&e.url?(i(e.url),u.current&&(u.current.value="")):alert(e.error||"上載失敗")}catch(e){console.error("檔案上載失敗:",e),alert("檔案上載失敗，請稍後再試")}finally{x(null)}},b=async()=>{if(l){h(!0);try{console.log("原始 URL:",l);let e="";if(l.includes("/storage/v1/object/public/")){let t=new URL(l).pathname.split("/"),r=t.findIndex(e=>"public"===e),s=t.findIndex(e=>"care-staff-files"===e);-1!==r&&-1!==s&&s>r&&(e=t.slice(s+1).join("/"))}if(!e&&l.includes("care-staff-files/")){let t=l.split("care-staff-files/");t.length>1&&(e=t[1])}if(!e&&l.includes("care-staff/")){let t=l.split("care-staff/");t.length>1&&(e="care-staff/"+t[1])}if(console.log("解析的檔案路徑:",e),!e)throw Error("無法解析檔案路徑，URL格式不正確");let{data:t,error:r}=await n.O.storage.from("care-staff-files").createSignedUrl(e,1800);if(r){console.error("生成簽名 URL 失敗:",r),console.log("嘗試直接打開原始 URL..."),window.open(l,"_blank");return}t?.signedUrl?(console.log("成功生成簽名 URL:",t.signedUrl),window.open(t.signedUrl,"_blank")):(console.log("無簽名 URL，嘗試原始 URL..."),window.open(l,"_blank"))}catch(e){console.error("生成檔案連結失敗:",e);try{console.log("使用備用方案打開原始 URL..."),window.open(l,"_blank")}catch(e){console.error("備用方案也失敗:",e),alert("無法打開檔案，請檢查檔案是否存在或聯絡管理員")}}finally{h(!1)}}};return(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:e}),s.jsx("div",{className:"mt-2",children:g?(0,s.jsxs)("div",{className:"border border-border-light rounded-apple-sm p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded flex items-center justify-center",children:s.jsx("svg",{className:"w-5 h-5 text-gray-600",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})})}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-medium text-text-primary",children:e}),s.jsx("p",{className:"text-xs text-text-tertiary",children:"已上載"})]})]}),s.jsx("button",{type:"button",onClick:b,disabled:m,className:"px-4 py-2 text-sm bg-mingcare-blue text-white rounded-apple-sm hover:bg-blue-600 transition-colors disabled:opacity-50",children:m?"生成中...":"點擊查看"})]}),s.jsx("div",{className:"mt-2 text-xs text-text-tertiary",children:"\uD83D\uDCA1 點擊「點擊查看」會生成30分鐘有效的安全連結"})]}):(0,s.jsxs)("div",{className:"border-2 border-dashed border-border-light rounded-apple-sm p-6 text-center hover:border-mingcare-blue transition-colors",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 text-text-tertiary",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:s.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsxs)("div",{className:"mt-4",children:[s.jsx("button",{type:"button",onClick:()=>{d||f||u.current?.click()},disabled:d||f,className:"px-4 py-2 bg-mingcare-blue text-white rounded-apple-sm text-sm hover:bg-blue-600 transition-colors disabled:opacity-50",children:f?"上載中...":"上載檔案"}),s.jsx("p",{className:"mt-2 text-xs text-text-tertiary",children:"JPG, PNG, PDF (最大 10MB)"})]}),f&&s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-4",children:s.jsx("div",{className:"bg-mingcare-blue h-2 rounded-full transition-all duration-300",style:{width:`${p?.progress||0}%`}})}),p?.status==="error"&&s.jsx("p",{className:"text-red-600 text-xs mt-2",children:p.error})]})}),s.jsx("input",{ref:u,type:"file",accept:".jpg,.jpeg,.png,.pdf",onChange:j,className:"hidden"})]})}function p(){let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(!0),[c,p]=(0,a.useState)([]),[x,m]=(0,a.useState)("card"),[h,u]=(0,a.useState)({}),[f,g]=(0,a.useState)(""),[j,b]=(0,a.useState)([]),[v,y]=(0,a.useState)(!1),[N,_]=(0,a.useState)(-1),[w,k]=(0,a.useState)({top:0,left:0,width:0}),[C,S]=(0,a.useState)(!1),[L,$]=(0,a.useState)(0),[E,P]=(0,a.useState)(1),[M]=(0,a.useState)(20),[D,O]=(0,a.useState)({field:"created_at",direction:"desc"}),[U,W]=(0,a.useState)(null),I=(0,a.useRef)(null),[T,A]=(0,a.useState)(!1),[R,B]=(0,a.useState)(null),[F,V]=(0,a.useState)(!1),[z,q]=(0,a.useState)(!1),[H,G]=(0,a.useState)({}),[J,X]=(0,a.useState)(!1),[Z,Y]=(0,a.useState)([]),[K,Q]=(0,a.useState)([]),[ee,et]=(0,a.useState)(!1),er=(0,i.useRouter)(),es=()=>{if(!I.current)return;let e=I.current.getBoundingClientRect(),t=window.scrollY,r=window.scrollX;k({top:e.bottom+t+2,left:e.left+r,width:e.width})},ea=e=>({陪診員:"bg-blue-100 text-blue-800",居家照顧員:"bg-green-100 text-green-800",家務助理:"bg-yellow-100 text-yellow-800",醫護支援人員:"bg-purple-100 text-purple-800",保健員:"bg-cyan-100 text-cyan-800",登記護士:"bg-indigo-100 text-indigo-800",註冊護士:"bg-blue-100 text-blue-800",護士學生:"bg-sky-100 text-sky-800",中國護士:"bg-teal-100 text-teal-800",註冊營養師:"bg-orange-100 text-orange-800",職業治療師:"bg-emerald-100 text-emerald-800",言語治療師:"bg-rose-100 text-rose-800",物理治療師:"bg-lime-100 text-lime-800",醫生:"bg-red-100 text-red-800",抽血員:"bg-pink-100 text-pink-800",物理治療助理:"bg-amber-100 text-amber-800",職業治療助理:"bg-violet-100 text-violet-800"})[e.replace(/\s*\([^)]*\)/g,"").trim()]||"bg-gray-100 text-gray-800",el=e=>e.replace(/\s*\([^)]*\)/g,"").trim(),ei=async(e,t=1,r)=>{try{let s=void 0!==e?e:h,{data:a,count:l}=await o.getCareStaff(s,t,M,void 0!==r?r:D);p(a),$(l)}catch(e){console.error("載入護理人員列表失敗:",e)}},[en,eo]=(0,a.useState)(!1),ec=async e=>{if(e.length<1){b([]),y(!1);return}try{console.log("開始搜尋建議:",e);let t=(await o.getCareStaffSuggestions({query:e})).data||[];console.log("搜尋建議結果:",t.length,"筆"),b(t),es(),y(!0)}catch(e){console.error("載入搜尋建議失敗:",e),b([]),y(!1)}},ed=async e=>{let t=e||f;if(t.trim()){let e={...h,search:t.trim()};u(e),P(1),await ei(e,1)}y(!1)},ep=e=>{g(e.name_chinese),y(!1),ed(e.name_chinese)},ex=e=>{let t=D.field===e&&"asc"===D.direction?"desc":"asc",r={field:e,direction:t};O(r),P(1),ei(h,1,r)},em=async e=>{try{V(!0);let t=await o.getCareStaffById(e.id);t.data?(B(t.data),A(!0),G({hkid_copy_url:t.data.hkid_copy_url||"",certificate_1:t.data.certificate_1||"",certificate_2:t.data.certificate_2||"",certificate_3:t.data.certificate_3||"",certificate_4:t.data.certificate_4||"",certificate_5:t.data.certificate_5||"",scrc_status:t.data.scrc_status||""})):alert(t.error||"無法載入護理人員詳細資料")}catch(e){console.error("載入護理人員詳細資料失敗:",e),alert("載入失敗，請稍後再試")}finally{V(!1)}},eh=async e=>{if(confirm(`確定要刪除護理人員「${e.name_chinese}」嗎？

此操作無法復原。`))try{V(!0);let t=await o.deleteCareStaff(e.id);t.success?(await ei(),A(!1),B(null),alert("護理人員已成功刪除")):alert(t.error||"刪除失敗，請稍後再試")}catch(e){console.error("刪除護理人員時發生錯誤:",e),alert("刪除失敗，請稍後再試")}finally{V(!1)}},eu=async e=>{if(R)try{q(!0);let t=e.get("name_chinese"),r=e.get("phone"),s=e.get("contract_status");if(!t?.trim()){alert("中文姓名為必填欄位");return}if(!r?.trim()){alert("聯絡電話為必填欄位");return}if(!/^\d{8}$/.test(r.replace(/\s+/g,""))){alert("聯絡電話必須為8位數字");return}if(!s){alert("合約狀態為必填欄位");return}let a={name_chinese:t.trim(),name_english:e.get("name_english")?.trim()||void 0,phone:r.replace(/\s+/g,""),email:e.get("email")?.trim()||void 0,hkid:e.get("hkid")?.trim()||void 0,dob:e.get("dob")||void 0,gender:e.get("gender")||void 0,preferred_area:e.get("preferred_area")||void 0,emergency_contact:e.get("emergency_contact")?.trim()||void 0,emergency_contact_phone:e.get("emergency_contact_phone")?.trim()||void 0},l=await o.updateCareStaff(R.id,a);l.data?(alert("護理人員資料已更新"),A(!1),B(null),await ei()):alert(l.error||"更新失敗")}catch(e){console.error("更新護理人員資料失敗:",e),alert("更新失敗，請稍後再試")}finally{q(!1)}},ef=async(e,t)=>{if(R)try{X(!0),G(r=>({...r,[e]:t})),(await o.updateCareStaff(R.id,{[e]:t})).data?(B(r=>r?{...r,[e]:t}:null),alert("檔案上載成功")):(G(t=>({...t,[e]:R[e]||""})),alert("更新資料庫失敗，已還原檔案狀態"))}catch(t){console.error("文件上載回寫失敗:",t),G(t=>({...t,[e]:R[e]||""})),alert("更新資料庫失敗，已還原檔案狀態")}finally{X(!1)}},eg=async e=>{if(R)try{X(!0),(await o.updateCareStaff(R.id,{[e]:null})).data?(G(t=>({...t,[e]:""})),B(t=>t?{...t,[e]:null}:null),alert("檔案連結已移除")):alert("移除失敗，請稍後再試")}catch(e){console.error("文件移除失敗:",e),alert("移除失敗，請稍後再試")}finally{X(!1)}};return r?s.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-mingcare-blue"}),s.jsx("p",{className:"mt-4 text-text-secondary",children:"載入中..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-bg-primary",children:[s.jsx("header",{className:"card-apple border-b border-border-light fade-in-apple sticky top-0 z-10",children:s.jsx("div",{className:"px-3 sm:px-4 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center py-3 sm:py-4 lg:py-6",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[s.jsx("h1",{className:"text-base sm:text-lg lg:text-xl font-bold text-text-primary mb-1 truncate",children:"護理人員管理"}),s.jsx("p",{className:"text-xs sm:text-sm text-text-secondary hidden sm:block",children:"管理護理人員資料和文件"})]}),s.jsx("button",{onClick:()=>er.push("/dashboard"),className:"btn-apple-secondary text-xs px-3 py-2 ml-3 flex-shrink-0",children:"返回"})]})})}),(0,s.jsxs)("main",{className:"px-3 sm:px-4 lg:px-8 py-3 sm:py-4 lg:py-6",children:[s.jsx("div",{className:"card-apple mb-3 sm:mb-4 lg:mb-6 fade-in-apple",style:{animationDelay:"0.1s"},children:(0,s.jsxs)("div",{className:"card-apple-content p-3 sm:p-4 lg:p-6",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 sm:pl-4",children:s.jsx("svg",{className:"h-4 w-4 sm:h-5 sm:w-5 text-text-tertiary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{ref:I,type:"text",value:f,onChange:e=>{let t=e.target.value;g(t),en||(U&&clearTimeout(U),t.length>=1?W(setTimeout(()=>{ec(t)},200)):(b([]),y(!1)))},onCompositionStart:()=>{eo(!0)},onCompositionEnd:e=>{eo(!1);let t=e.currentTarget.value;t.length>=1?ec(t):(b([]),y(!1))},onKeyDown:e=>{if(v&&j.length>0)switch(e.key){case"ArrowDown":e.preventDefault(),_(e=>e<j.length-1?e+1:e);break;case"ArrowUp":e.preventDefault(),_(e=>e>0?e-1:-1);break;case"Enter":e.preventDefault(),N>=0&&N<j.length?ep(j[N]):ed();break;case"Escape":y(!1),_(-1)}else"Enter"===e.key?ed():"Escape"===e.key&&y(!1)},onFocus:()=>{es(),f.length>=1&&j.length>0&&y(!0)},onBlur:()=>{setTimeout(()=>{y(!1)},150)},placeholder:"智慧搜尋：姓名1字/員工編號3字/電話4字...",className:"w-full pl-8 sm:pl-12 pr-8 sm:pr-12 py-2 sm:py-3 border border-border-light rounded-apple-pill bg-white text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-brand-primary focus:border-transparent transition-all duration-200 text-sm sm:text-base"}),s.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 sm:pr-4",children:f&&s.jsx("button",{onClick:()=>{g("");let e={...h};delete e.search,u(e),P(1),ei(e,1)},className:"p-1 text-text-tertiary hover:text-text-secondary transition-colors rounded-full hover:bg-bg-tertiary",children:s.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),C&&v&&f.length>=1&&(0,l.createPortal)(s.jsx("div",{className:"fixed bg-white border border-border-light rounded-apple-sm shadow-apple-card max-h-80 overflow-y-auto z-[9999] scrollbar-thin scrollbar-thumb-bg-tertiary scrollbar-track-transparent",style:{top:`${w.top}px`,left:`${w.left}px`,width:`${w.width}px`,minWidth:"300px",scrollBehavior:"smooth",scrollbarWidth:"thin",scrollbarColor:"rgb(156 163 175) transparent"},onMouseDown:e=>e.preventDefault(),children:j.length>0?(0,s.jsxs)(s.Fragment,{children:[j.length>5&&(0,s.jsxs)("div",{className:"px-4 py-2 bg-bg-secondary border-b border-border-light text-xs text-text-secondary",children:["找到 ",j.length," 個結果，可上下滾動或使用 ↑↓ 鍵導航"]}),j.length<=5&&j.length>0&&s.jsx("div",{className:"px-4 py-1 bg-bg-secondary border-b border-border-light text-xs text-text-tertiary text-center",children:"使用 ↑↓ 鍵選擇，Enter 確認"}),j.map((e,t)=>{let r=t===N;return s.jsx("button",{onClick:()=>ep(e),className:`w-full text-left px-4 py-3 transition-colors border-b border-border-light last:border-b-0 group focus:outline-none ${r?"bg-brand-primary text-white":"hover:bg-bg-tertiary focus:bg-bg-tertiary"}`,ref:e=>{r&&e&&e.scrollIntoView({block:"nearest",behavior:"smooth"})},children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:`text-sm font-medium transition-colors ${r?"text-white":"text-text-primary group-hover:text-brand-primary group-focus:text-brand-primary"}`,children:e.name_chinese}),(0,s.jsxs)("div",{className:`text-xs mt-1 space-y-1 ${r?"text-blue-100":"text-text-secondary"}`,children:[e.staff_id&&(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-1",children:"\uD83D\uDC64"}),s.jsx("span",{children:e.staff_id})]}),e.phone&&(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("span",{className:"mr-1",children:"\uD83D\uDCDE"}),s.jsx("span",{children:e.phone})]})]})]}),(0,s.jsxs)("div",{className:`text-xs px-2 py-1 rounded-full transition-colors ${r?"bg-blue-500 text-white":"text-text-tertiary bg-bg-secondary group-hover:bg-brand-secondary group-focus:bg-brand-secondary"}`,children:["name"===e.match_type&&"姓名","phone"===e.match_type&&"電話","staff_id"===e.match_type&&"編號","mixed"===e.match_type&&"混合"]})]})},e.id)})]}):(0,s.jsxs)("div",{className:"px-4 py-6 text-center text-text-secondary",children:[s.jsx("div",{className:"text-sm mb-2",children:"沒有找到相關護理人員"}),s.jsx("div",{className:"text-xs",children:"請嘗試其他關鍵字"})]})}),document.body)]}),"            ",(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple text-sm sm:text-base",children:"性別"}),(0,s.jsxs)("select",{value:h.gender||"",onChange:e=>{let t={...h};e.target.value?t.gender=e.target.value:delete t.gender,u(t),P(1),ei(t,1)},className:"form-select-apple text-sm sm:text-base py-2 sm:py-3",children:[s.jsx("option",{value:"",children:"全部性別"}),s.jsx("option",{value:"男",children:"男性"}),s.jsx("option",{value:"女",children:"女性"})]})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple text-sm sm:text-base",children:"偏好地區"}),(0,s.jsxs)("select",{value:h.preferred_area||"",onChange:e=>{let t={...h};e.target.value?t.preferred_area=e.target.value:delete t.preferred_area,u(t),P(1),ei(t,1)},className:"form-select-apple text-sm sm:text-base py-2 sm:py-3",children:[s.jsx("option",{value:"",children:"全部地區"}),s.jsx("option",{value:"所有區域",children:"所有區域"}),s.jsx("option",{value:"中西區",children:"中西區"}),s.jsx("option",{value:"東區",children:"東區"}),s.jsx("option",{value:"南區",children:"南區"}),s.jsx("option",{value:"灣仔區",children:"灣仔區"}),s.jsx("option",{value:"油尖旺區",children:"油尖旺區"}),s.jsx("option",{value:"深水埗區",children:"深水埗區"}),s.jsx("option",{value:"九龍城區",children:"九龍城區"}),s.jsx("option",{value:"黃大仙區",children:"黃大仙區"}),s.jsx("option",{value:"觀塘區",children:"觀塘區"}),s.jsx("option",{value:"西貢區",children:"西貢區"}),s.jsx("option",{value:"沙田區",children:"沙田區"}),s.jsx("option",{value:"大埔區",children:"大埔區"}),s.jsx("option",{value:"北區",children:"北區"}),s.jsx("option",{value:"荃灣區",children:"荃灣區"}),s.jsx("option",{value:"屯門區",children:"屯門區"}),s.jsx("option",{value:"元朗區",children:"元朗區"}),s.jsx("option",{value:"葵青區",children:"葵青區"}),s.jsx("option",{value:"離島區",children:"離島區"})]})]}),(0,s.jsxs)("div",{className:"form-group-apple sm:col-span-2 lg:col-span-1",children:[s.jsx("label",{className:"form-label-apple text-sm sm:text-base",children:"職位"}),(0,s.jsxs)("select",{value:h.job_position||"",onChange:e=>{let t={...h};e.target.value?t.job_position=e.target.value:delete t.job_position,u(t),P(1),ei(t,1)},className:"form-select-apple text-sm sm:text-base py-2 sm:py-3",children:[s.jsx("option",{value:"",children:"全部職位"}),s.jsx("option",{value:"陪診員 (Medical Escort)",children:"陪診員 (Medical Escort)"}),s.jsx("option",{value:"居家照顧員(PCW)",children:"居家照顧員(PCW)"}),s.jsx("option",{value:"家務助理(Housekeeper)",children:"家務助理(Housekeeper)"}),s.jsx("option",{value:"醫護支援人員(CRSW)",children:"醫護支援人員(CRSW)"}),s.jsx("option",{value:"保健員(HCW)",children:"保健員(HCW)"}),s.jsx("option",{value:"登記護士(EN)",children:"登記護士(EN)"}),s.jsx("option",{value:"註冊護士(RN)",children:"註冊護士(RN)"}),s.jsx("option",{value:"護士學生",children:"護士學生"}),s.jsx("option",{value:"中國護士",children:"中國護士"}),s.jsx("option",{value:"註冊營養師(Dietitian)",children:"註冊營養師(Dietitian)"}),s.jsx("option",{value:"職業治療師(OT)",children:"職業治療師(OT)"}),s.jsx("option",{value:"言語治療師(ST)",children:"言語治療師(ST)"}),s.jsx("option",{value:"物理治療師(PT)",children:"物理治療師(PT)"}),s.jsx("option",{value:"醫生(Doctor)",children:"醫生(Doctor)"}),s.jsx("option",{value:"抽血員(Phlebotomist)",children:"抽血員(Phlebotomist)"}),s.jsx("option",{value:"物理治療助理 (PTA)",children:"物理治療助理 (PTA)"}),s.jsx("option",{value:"職業治療助理 (OTA)",children:"職業治療助理 (OTA)"})]})]})]}),(Object.keys(h).length>0||f.trim())&&s.jsx("div",{className:"mt-6 flex justify-end",children:(0,s.jsxs)("button",{onClick:async()=>{u({}),P(1),g(""),y(!1);try{n(!0);let{data:e,count:t}=await o.getCareStaff({},1,M);p(e),$(t)}catch(e){console.error("重新載入護理人員列表失敗:",e)}finally{n(!1)}},className:"text-sm text-text-secondary hover:text-text-primary flex items-center space-x-1 transition-colors",children:[s.jsx("svg",{className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),s.jsx("span",{children:"清除所有篩選"})]})})]})}),s.jsx("div",{className:"card-apple mb-3 sm:mb-4 lg:mb-6 fade-in-apple",style:{animationDelay:"0.2s"},children:s.jsx("div",{className:"card-apple-content p-3 sm:p-4 lg:p-6",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[s.jsx("div",{className:"flex items-center space-x-6",children:(0,s.jsxs)("span",{className:"text-sm sm:text-base text-text-primary",children:["共 ",s.jsx("span",{className:"font-semibold text-mingcare-blue",children:L})," 位護理人員"]})}),s.jsx("div",{className:"flex items-center space-x-4",children:(0,s.jsxs)("div",{className:"flex rounded-apple-sm border border-border-light p-1 bg-bg-tertiary",children:[s.jsx("button",{onClick:()=>m("card"),className:`px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-apple-xs transition-all duration-200 ${"card"===x?"bg-white text-mingcare-blue shadow-apple":"text-text-secondary hover:text-text-primary"}`,children:(0,s.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[s.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),s.jsx("span",{className:"hidden sm:inline",children:"卡片檢視"}),s.jsx("span",{className:"sm:hidden",children:"卡片"})]})}),s.jsx("button",{onClick:()=>m("list"),className:`px-3 sm:px-4 py-2 text-xs sm:text-sm font-medium rounded-apple-xs transition-all duration-200 ${"list"===x?"bg-white text-mingcare-blue shadow-apple":"text-text-secondary hover:text-text-primary"}`,children:(0,s.jsxs)("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[s.jsx("svg",{className:"h-3 w-3 sm:h-4 sm:w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),s.jsx("span",{className:"hidden sm:inline",children:"列表檢視"}),s.jsx("span",{className:"sm:hidden",children:"列表"})]})})]})})]})})}),s.jsx("div",{className:"card-apple fade-in-apple",style:{animationDelay:"0.3s"},children:s.jsx("div",{className:"card-apple-content p-3 sm:p-4 lg:p-6",children:0===c.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 text-text-tertiary mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),s.jsx("h3",{className:"text-apple-heading text-text-primary mb-2",children:Object.keys(h).length>0?"沒有符合條件的護理人員":"暫無護理人員資料"}),s.jsx("p",{className:"text-apple-body text-text-secondary mb-6",children:Object.keys(h).length>0?"請嘗試調整搜尋條件或篩選器":"目前還沒有護理人員資料"})]}):s.jsx(s.Fragment,{children:"list"===x?s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-border-light",children:[s.jsx("thead",{className:"bg-bg-secondary",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left",children:(0,s.jsxs)("button",{onClick:()=>ex("name_chinese"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[s.jsx("span",{children:"護理人員"}),"name_chinese"===D.field&&s.jsx("svg",{className:`h-3 w-3 transform ${"desc"===D.direction?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),s.jsx("th",{className:"px-6 py-3 text-left",children:(0,s.jsxs)("button",{onClick:()=>ex("staff_id"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[s.jsx("span",{children:"員工編號"}),"staff_id"===D.field&&s.jsx("svg",{className:`h-3 w-3 transform ${"desc"===D.direction?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),s.jsx("th",{className:"px-6 py-3 text-left",children:(0,s.jsxs)("button",{onClick:()=>ex("preferred_area"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[s.jsx("span",{children:"偏好地區"}),"preferred_area"===D.field&&s.jsx("svg",{className:`h-3 w-3 transform ${"desc"===D.direction?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-text-tertiary uppercase tracking-wider",children:"職位"}),s.jsx("th",{className:"px-6 py-3 text-left",children:(0,s.jsxs)("button",{onClick:()=>ex("contract_status"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[s.jsx("span",{children:"合約狀態"}),"contract_status"===D.field&&s.jsx("svg",{className:`h-3 w-3 transform ${"desc"===D.direction?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})}),s.jsx("th",{className:"px-6 py-3 text-left",children:(0,s.jsxs)("button",{onClick:()=>ex("created_at"),className:"flex items-center space-x-1 text-xs font-medium text-text-tertiary uppercase tracking-wider hover:text-text-primary transition-colors",children:[s.jsx("span",{children:"建立日期"}),"created_at"===D.field&&s.jsx("svg",{className:`h-3 w-3 transform ${"desc"===D.direction?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})]})})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-border-light",children:c.map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-bg-tertiary transition-colors cursor-pointer",onClick:()=>em(e),children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{children:[s.jsx("div",{className:"text-apple-body text-text-primary font-medium",children:e.name_chinese}),s.jsx("div",{className:"text-apple-caption text-text-secondary",children:e.phone})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:e.staff_id||"沒有提供"}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:e.preferred_area||"沒有提供"}),s.jsx("td",{className:"px-6 py-4",children:s.jsx("div",{className:"flex flex-wrap gap-1 max-w-xs",children:e.job_position&&e.job_position.length>0?e.job_position.map((e,t)=>s.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ea(e)}`,children:el(e)},t)):s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"沒有提供"})})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"同意"===e.contract_status?"bg-green-100 text-green-800":"不同意"===e.contract_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.contract_status||"沒有提供"})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-apple-caption text-text-secondary",children:new Date(e.created_at).toLocaleDateString("zh-TW")})]},e.id))})]})}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map((e,t)=>s.jsx("div",{className:"card-apple group cursor-pointer transition-all duration-200 hover:shadow-apple-card",style:{animationDelay:`${.4+.05*t}s`},onClick:()=>em(e),children:(0,s.jsxs)("div",{className:"card-apple-content",children:[s.jsx("div",{className:"flex justify-between items-start mb-4",children:(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-apple-heading text-text-primary truncate mb-1",children:e.name_chinese}),s.jsx("p",{className:"text-apple-caption text-text-secondary",children:e.staff_id||"沒有提供"})]})}),(0,s.jsxs)("div",{className:"space-y-3 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center text-apple-caption text-text-secondary",children:[s.jsx("svg",{className:"h-4 w-4 mr-3 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),s.jsx("span",{children:e.phone})]}),(0,s.jsxs)("div",{className:"flex items-center text-apple-caption text-text-secondary",children:[(0,s.jsxs)("svg",{className:"h-4 w-4 mr-3 text-text-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),s.jsx("span",{children:e.preferred_area||"沒有提供"})]})]}),s.jsx("div",{className:"mb-4",children:s.jsx("div",{className:"flex flex-wrap gap-2",children:e.job_position&&e.job_position.length>0?e.job_position.map((e,t)=>s.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${ea(e)}`,children:el(e)},t)):s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"沒有提供"})})}),s.jsx("div",{className:"border-t border-border-light pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-center text-apple-caption text-text-tertiary",children:[(0,s.jsxs)("span",{children:["建立於 ",new Date(e.created_at).toLocaleDateString("zh-TW")]}),s.jsx("svg",{className:"h-4 w-4 text-mingcare-blue group-hover:translate-x-1 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})},e.id))})})})}),T&&R&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:()=>A(!1)}),s.jsx("div",{className:"absolute right-0 top-0 h-full w-full max-w-2xl bg-white shadow-xl transform transition-transform",children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[s.jsx("div",{className:"border-b border-border-light px-6 py-4 bg-bg-secondary",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-text-primary",children:"編輯護理人員"}),(0,s.jsxs)("p",{className:"text-sm text-text-secondary mt-1",children:[R.name_chinese," (",R.staff_id||"未分配編號",")"]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("button",{onClick:()=>eh(R),disabled:F,className:"px-4 py-2 bg-red-500 text-white rounded-apple-sm hover:bg-red-600 transition-colors disabled:opacity-50 text-sm",children:F?"刪除中...":"刪除"}),s.jsx("button",{onClick:()=>A(!1),className:"p-2 text-text-tertiary hover:text-text-primary transition-colors",children:s.jsx("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}),s.jsx("form",{action:eu,className:"flex-1 overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"基本資料"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"中文姓名 *"}),s.jsx("input",{type:"text",name:"name_chinese",defaultValue:R.name_chinese||"",className:"form-input-apple",placeholder:"請輸入中文姓名"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"員工編號"}),s.jsx("input",{type:"text",value:R.staff_id||"系統自動生成",className:"form-input-apple bg-bg-secondary",disabled:!0})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"英文姓名"}),s.jsx("input",{type:"text",name:"name_english",defaultValue:R.name_english||"",className:"form-input-apple",placeholder:"請輸入英文姓名"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.name_english?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"電子郵箱"}),s.jsx("input",{type:"email",name:"email",defaultValue:R.email||"",className:"form-input-apple",placeholder:"請輸入電子郵箱"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.email?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"身份證號碼"}),s.jsx("input",{type:"text",name:"hkid",defaultValue:R.hkid||"",className:"form-input-apple",placeholder:"請輸入身份證號碼"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.hkid?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"出生日期"}),s.jsx("input",{type:"date",name:"dob",defaultValue:R.dob||"",className:"form-input-apple"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.dob?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"聯絡電話 *"}),s.jsx("input",{type:"tel",name:"phone",defaultValue:R.phone||"",className:"form-input-apple",placeholder:"請輸入8位數電話號碼"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"性別"}),(0,s.jsxs)("select",{name:"gender",defaultValue:R.gender||"",className:"form-select-apple",children:[s.jsx("option",{value:"",children:"請選擇性別"}),s.jsx("option",{value:"男",children:"男性"}),s.jsx("option",{value:"女",children:"女性"})]}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.gender?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"偏好工作區域"}),(0,s.jsxs)("select",{name:"preferred_area",defaultValue:R.preferred_area||"",className:"form-select-apple",children:[s.jsx("option",{value:"",children:"請選擇偏好地區"}),s.jsx("option",{value:"所有區域",children:"所有區域"}),s.jsx("option",{value:"中西區",children:"中西區"}),s.jsx("option",{value:"東區",children:"東區"}),s.jsx("option",{value:"南區",children:"南區"}),s.jsx("option",{value:"灣仔區",children:"灣仔區"}),s.jsx("option",{value:"油尖旺區",children:"油尖旺區"}),s.jsx("option",{value:"深水埗區",children:"深水埗區"}),s.jsx("option",{value:"九龍城區",children:"九龍城區"}),s.jsx("option",{value:"黃大仙區",children:"黃大仙區"}),s.jsx("option",{value:"觀塘區",children:"觀塘區"}),s.jsx("option",{value:"西貢區",children:"西貢區"}),s.jsx("option",{value:"沙田區",children:"沙田區"}),s.jsx("option",{value:"大埔區",children:"大埔區"}),s.jsx("option",{value:"北區",children:"北區"}),s.jsx("option",{value:"荃灣區",children:"荃灣區"}),s.jsx("option",{value:"屯門區",children:"屯門區"}),s.jsx("option",{value:"元朗區",children:"元朗區"}),s.jsx("option",{value:"葵青區",children:"葵青區"}),s.jsx("option",{value:"離島區",children:"離島區"})]}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.preferred_area?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"合約狀態 *"}),(0,s.jsxs)("select",{name:"contract_status",defaultValue:R.contract_status||"",className:"form-select-apple",children:[s.jsx("option",{value:"",children:"請選擇合約狀態"}),s.jsx("option",{value:"同意",children:"同意"}),s.jsx("option",{value:"不同意",children:"不同意"})]}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.contract_status?"":"沒有提供"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"緊急聯絡資料"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"緊急聯絡人姓名"}),s.jsx("input",{type:"text",name:"emergency_contact",defaultValue:R.emergency_contact||"",className:"form-input-apple",placeholder:"請輸入緊急聯絡人姓名"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.emergency_contact?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"緊急聯絡人電話"}),s.jsx("input",{type:"tel",name:"emergency_contact_phone",defaultValue:R.emergency_contact_phone||"",className:"form-input-apple",placeholder:"請輸入緊急聯絡人電話"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.emergency_contact_phone?"":"沒有提供"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"其他資料"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"國籍"}),s.jsx("input",{type:"text",name:"nationality",defaultValue:R.nationality||"",className:"form-input-apple",placeholder:"請輸入國籍"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.nationality?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"年資（年）"}),s.jsx("input",{type:"text",name:"experience_years",defaultValue:R.experience_years||"",className:"form-input-apple",placeholder:"請輸入年資"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.experience_years?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"新冠疫苗"}),(0,s.jsxs)("select",{name:"covid_vaccine",defaultValue:R.covid_vaccine||"",className:"form-select-apple",children:[s.jsx("option",{value:"",children:"請選擇疫苗狀態"}),s.jsx("option",{value:"1針",children:"1針"}),s.jsx("option",{value:"2針",children:"2針"}),s.jsx("option",{value:"3針",children:"3針"}),s.jsx("option",{value:"4針",children:"4針"}),s.jsx("option",{value:"無接種",children:"無接種"}),s.jsx("option",{value:"Other",children:"其他"})]}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.covid_vaccine?"":"沒有提供"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"介紹人資料"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"介紹人姓名"}),s.jsx("input",{type:"text",name:"referrer",defaultValue:R.referrer||"",className:"form-input-apple",placeholder:"請輸入介紹人姓名"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.referrer?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"介紹人電話"}),s.jsx("input",{type:"tel",name:"referrer_phone",defaultValue:R.referrer_phone||"",className:"form-input-apple",placeholder:"請輸入介紹人電話"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.referrer_phone?"":"沒有提供"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"前雇主資料"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"公司名稱"}),s.jsx("input",{type:"text",name:"company_name",defaultValue:R.company_name||"",className:"form-input-apple",placeholder:"請輸入前雇主公司名稱"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.company_name?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"職位"}),s.jsx("input",{type:"text",name:"company_position",defaultValue:R.company_position||"",className:"form-input-apple",placeholder:"請輸入在前雇主的職位"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.company_position?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"任職期間"}),s.jsx("input",{type:"text",name:"employment_period",defaultValue:R.employment_period||"",className:"form-input-apple",placeholder:"請輸入任職期間"}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.employment_period?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple md:col-span-2",children:[s.jsx("label",{className:"form-label-apple",children:"主要職責"}),s.jsx("textarea",{name:"main_duties",defaultValue:R.main_duties||"",className:"form-textarea-apple",placeholder:"請輸入主要職責",rows:3}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.main_duties?"":"沒有提供"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"職位與語言"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"申請職位"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:["陪診員 (Medical Escort)","居家照顧員(PCW)","家務助理(Housekeeper)","醫護支援人員(CRSW)","保健員(HCW)","登記護士(EN)","註冊護士(RN)","護士學生","中國護士","註冊營養師(Dietitian)","職業治療師(OT)","言語治療師(ST)","物理治療師(PT)","醫生(Doctor)","抽血員(Phlebotomist)","物理治療助理 (PTA)","職業治療助理 (OTA)"].map(e=>(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",defaultChecked:R.job_position?.includes(e),className:"rounded border-border-light text-mingcare-blue focus:ring-mingcare-blue mr-2"}),s.jsx("span",{className:"text-sm text-text-secondary",children:e})]},e))}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.job_position&&R.job_position.length>0?"":"沒有提供"})]}),(0,s.jsxs)("div",{className:"form-group-apple",children:[s.jsx("label",{className:"form-label-apple",children:"語言能力"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mt-2",children:["廣東話","英文","普通話","福建話","潮州話","客家話","上海話","四邑話"].map(e=>(0,s.jsxs)("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:R?.language?.includes(e)||!1,onChange:t=>{let r;if(!R)return;let s=R.language||[];r=t.target.checked?[...s,e]:s.filter(t=>t!==e),B({...R,language:r})},className:"rounded border-border-light text-mingcare-blue focus:ring-mingcare-blue mr-2"}),s.jsx("span",{className:"text-sm text-text-secondary",children:e})]},e))}),s.jsx("p",{className:"text-xs text-text-tertiary mt-1",children:R.language&&R.language.length>0?"":"沒有提供"})]})]})]}),(0,s.jsxs)("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4 border-b border-border-light pb-2",children:"文件管理"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(d,{label:"身份證副本",fieldName:"hkid_copy_url",staffId:R.staff_id||"",currentUrl:H.hkid_copy_url,onUploadSuccess:e=>ef("hkid_copy_url",e),onRemove:()=>eg("hkid_copy_url"),disabled:J}),[1,2,3,4,5].map(e=>s.jsx(d,{label:`證書 ${e}`,fieldName:`certificate_${e}`,staffId:R.staff_id||"",currentUrl:H[`certificate_${e}`],onUploadSuccess:t=>ef(`certificate_${e}`,t),onRemove:()=>eg(`certificate_${e}`),disabled:J},e)),s.jsx(d,{label:"SCRC 文件",fieldName:"scrc_status",staffId:R.staff_id||"",currentUrl:H.scrc_status,onUploadSuccess:e=>ef("scrc_status",e),onRemove:()=>eg("scrc_status"),disabled:J})]})]})]})}),s.jsx("div",{className:"border-t border-border-light px-6 py-4 bg-bg-secondary",children:(0,s.jsxs)("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{onClick:()=>A(!1),type:"button",className:"px-4 py-2 border border-border-light rounded-apple-sm text-text-secondary hover:text-text-primary transition-colors",children:"取消"}),s.jsx("button",{onClick:e=>{e.preventDefault();let t=e.currentTarget.closest(".flex.flex-col.h-full")?.querySelector("form");t&&eu(new FormData(t))},disabled:z,type:"button",className:"px-4 py-2 bg-mingcare-blue text-white rounded-apple-sm hover:bg-blue-600 transition-colors disabled:opacity-50",children:z?"保存中...":"保存"})]})})]})})]})]})]})}},5442:(e,t,r)=>{"use strict";r.d(t,{O:()=>s});let s=(0,r(5623).AY)("https://cvkxlvdicympakfecgvv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2a3hsdmRpY3ltcGFrZmVjZ3Z2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0MjkxODEsImV4cCI6MjA2NzAwNTE4MX0.jp2fPKcBcG4-042UoN3OieR553WAgABhJIujiDJAt-I")},8239:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(8570).createProxy)(String.raw`/Users/joecheung/Documents/GitHub/mingcare-intranet/app/care-staff/page.tsx#default`)},1506:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>i});var s=r(9510),a=r(5384),l=r.n(a);r(7272);let i={title:"明家居家護理服務 - Intranet",description:"明家居家護理服務內部管理系統"};function n({children:e}){return s.jsx("html",{lang:"zh-TW",children:s.jsx("body",{className:l().className,children:e})})}},9058:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var s=r(6621);let a=e=>[{type:"image/png",sizes:"987x286",url:(0,s.fillMetadataSegment)("/mingcare-intranet",e.params,"icon.png")+"?ce74063d6acc4f04"}]},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,892,830],()=>r(9515));module.exports=s})();