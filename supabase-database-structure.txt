========================================================================
MingCare Supabase â€” Structure / RLS / Triggers / Enums  (EN â†” ä¸­æ–‡åƒè€ƒ)
Updated: 2025-08-13
========================================================================

# å‘½åä¸€è‡´æ€§ï¼ˆé—œéµå°ç…§ï¼‰
id = ç³»çµ± ID
created_at = å»ºç«‹æ™‚é–“
updated_at = æ›´æ–°æ™‚é–“
service_date = æœå‹™æ—¥æœŸ
customer_id = é …ç›®ç·¨è™Ÿ
customer_name = å®¢æˆ¶å§“å
phone = å®¢æˆ¶é›»è©±
service_address = æœå‹™åœ°å€
start_time = é–‹å§‹æ™‚é–“
end_time = çµæŸæ™‚é–“
service_hours = æœå‹™æ™‚æ•¸
care_staff_name = è­·ç†äººå“¡
service_fee = æœå‹™è²»ç”¨
staff_salary = è­·ç†äººå“¡å·¥è³‡
hourly_rate = æ¯å°æ™‚æ”¶è²»
hourly_salary = æ¯å°æ™‚å·¥è³‡
service_type = æœå‹™é¡å‹
project_category = æ‰€å±¬é …ç›®
project_manager = é …ç›®ç¶“ç† / è² è²¬åŒäº‹ï¼ˆä¾è¡¨æ ¼èªå¢ƒï¼‰

staff_id = å“¡å·¥ç·¨è™Ÿ
name_chinese = ä¸­æ–‡å§“å
name_english = è‹±æ–‡å§“å
email = é›»éƒµ
hkid = èº«ä»½è­‰è™Ÿç¢¼
dob = å‡ºç”Ÿæ—¥æœŸ
gender = æ€§åˆ¥
nationality = åœ‹ç±
preferred_area = åå¥½å·¥ä½œå€åŸŸ
emergency_contact = ç·Šæ€¥è¯çµ¡äºº
emergency_contact_phone = ç·Šæ€¥è¯çµ¡é›»è©±
language (text[]) = èªè¨€ï¼ˆå¤šé¸ï¼‰
job_position (text[]) = ç”³è«‹è·ä½ï¼ˆå¤šé¸ï¼‰
experience_years = å¹´è³‡ï¼ˆå¹´ï¼‰
covid_vaccine = æ–°å† ç–«è‹—
referrer = ä»‹ç´¹äººå§“å
referrer_phone = ä»‹ç´¹äººé›»è©±
company_name = å…¬å¸åç¨±ï¼ˆå‰é›‡ä¸»ï¼‰
company_position = è·ä½ï¼ˆå‰é›‡ä¸»ï¼‰
employment_period = ä»»è·æœŸé–“
main_duties = ä¸»è¦è·è²¬
hkid_copy_url = èº«ä»½è­‰å‰¯æœ¬é€£çµ
certificate_1..5 = è­‰æ›¸1..5ï¼ˆé€£çµï¼‰
scrc_status = SCRCï¼ˆæ–‡ä»¶é€£çµï¼‰
contract_status = åˆç´„ç‹€æ…‹

customer_type = åˆ†é¡
voucher_number = ç¤¾å€åˆ¸è™Ÿç¢¼
charity_support = æ˜¯å¦éœ€è¦æ…ˆå–„æ©Ÿæ§‹è´ŠåŠ©
district = å®¢æˆ¶åœ°å€
age = å¹´é½¡
health_status = èº«é«”ç‹€æ³
introducer = ä»‹ç´¹äºº
voucher_application_status = ç¤¾å€åˆ¸ç”³è«‹ç‹€æ³
lds_status = LDS è™Ÿç¢¼ç‹€æ³
home_visit_status = å…¬å¸å®¶è¨ªç‹€æ³
copay_level = è‡ªä»˜æ¯”ä¾‹ç­‰ç´š

------------------------------------------------------------------------
TABLESï¼ˆè¡¨çµæ§‹ï¼‰

[public.billing_salary_data]
- id (uuid, NOT NULL, default uuid_generate_v4()) = ç³»çµ± ID
- service_date (date) = æœå‹™æ—¥æœŸ
- customer_id (text) = é …ç›®ç·¨è™Ÿ
- customer_name (text) = å®¢æˆ¶å§“å
- phone (text) = å®¢æˆ¶é›»è©±
- service_address (text) = æœå‹™åœ°å€
- start_time (text) = é–‹å§‹æ™‚é–“
- end_time (text) = çµæŸæ™‚é–“
- service_hours (numeric) = æœå‹™æ™‚æ•¸
- care_staff_name (text) = è­·ç†äººå“¡
- service_fee (numeric) = æœå‹™è²»ç”¨
- staff_salary (numeric) = è­·ç†äººå“¡å·¥è³‡
- hourly_rate (numeric) = æ¯å°æ™‚æ”¶è²»
- hourly_salary (numeric) = æ¯å°æ™‚å·¥è³‡
- service_type (service_type_enum) = æœå‹™é¡å‹
- project_category (project_category_enum) = æ‰€å±¬é …ç›®
- project_manager (project_manager_enum) = é …ç›®ç¶“ç†
- created_at (timestamptz, default now()) = å»ºç«‹æ™‚é–“
- updated_at (timestamptz, default now()) = æ›´æ–°æ™‚é–“

[public.care_staff_profiles]
- id (uuid, NOT NULL, default gen_random_uuid()) = ç³»çµ± ID
- staff_id (text) = å“¡å·¥ç·¨è™Ÿ
- name_chinese (text) = ä¸­æ–‡å§“å
- name_english (text) = è‹±æ–‡å§“å
- phone (text) = å®¢æˆ¶é›»è©±
- email (text) = é›»éƒµ
- hkid (text) = èº«ä»½è­‰è™Ÿç¢¼
- dob (date) = å‡ºç”Ÿæ—¥æœŸ
- gender (gender_enum) = æ€§åˆ¥
- nationality (text) = åœ‹ç±
- preferred_area (preferred_area_enum) = åå¥½å·¥ä½œå€åŸŸ
- emergency_contact (text) = ç·Šæ€¥è¯çµ¡äºº
- emergency_contact_phone (text) = ç·Šæ€¥è¯çµ¡é›»è©±
- language (text[]) = èªè¨€ï¼ˆå¤šé¸ï¼‰
- job_position (text[]) = ç”³è«‹è·ä½ï¼ˆå¤šé¸ï¼‰
- experience_years (text) = å¹´è³‡ï¼ˆå¹´ï¼‰
- covid_vaccine (covid_vaccine_enum) = æ–°å† ç–«è‹—
- referrer (text) = ä»‹ç´¹äººå§“å
- referrer_phone (text) = ä»‹ç´¹äººé›»è©±
- company_name (text) = å…¬å¸åç¨±ï¼ˆå‰é›‡ä¸»ï¼‰
- company_position (text) = è·ä½ï¼ˆå‰é›‡ä¸»ï¼‰
- employment_period (text) = ä»»è·æœŸé–“
- main_duties (text) = ä¸»è¦è·è²¬
- hkid_copy_url (text) = èº«ä»½è­‰å‰¯æœ¬é€£çµ
- certificate_1..5 (text) = è­‰æ›¸é€£çµ 1..5
- scrc_status (text) = SCRCï¼ˆæ–‡ä»¶é€£çµï¼‰
- contract_status (contract_status_enum) = åˆç´„ç‹€æ…‹
- created_at (timestamptz, default now()) = å»ºç«‹æ™‚é–“

[public.customer_personal_data]
- id (uuid, NOT NULL, default gen_random_uuid()) = ç³»çµ± ID
- customer_id (text) = é …ç›®ç·¨è™Ÿ
- customer_type (customer_type_enum, NOT NULL) = å®¢æˆ¶åˆ†é¡
- voucher_number (text) = ç¤¾å€åˆ¸è™Ÿç¢¼
- charity_support (boolean) = æ˜¯å¦éœ€è¦æ…ˆå–„æ©Ÿæ§‹è´ŠåŠ©
- customer_name (text, NOT NULL) = å®¢æˆ¶å§“å
- phone (text) = å®¢æˆ¶é›»è©±
- district (district_enum) = å®¢æˆ¶åœ°å€
- service_address (text, NOT NULL) = æœå‹™åœ°å€
- hkid (text) = èº«ä»½è­‰è™Ÿç¢¼
- dob (date) = å‡ºç”Ÿæ—¥æœŸ
- age (integer) = å¹´é½¡
- health_status (health_status_enum) = èº«é«”ç‹€æ³
- created_at (timestamptz, default now()) = å»ºç«‹æ™‚é–“
- introducer (introducer_enum) = ä»‹ç´¹äºº
- voucher_application_status (voucher_application_status_enum) = ç¤¾å€åˆ¸ç”³è«‹ç‹€æ³
- lds_status (lds_status_enum) = LDS è™Ÿç¢¼ç‹€æ³
- home_visit_status (home_visit_status_enum) = å…¬å¸å®¶è¨ªç‹€æ³
- project_manager (staff_owner_enum) = è² è²¬åŒäº‹
- copay_level (copay_level_enum) = è‡ªä»˜æ¯”ä¾‹ç­‰ç´š

[public.commission_rate_introducer]
- id (uuid, NOT NULL, default gen_random_uuid()) = ç³»çµ± ID
- introducer (introducer_enum, NOT NULL) = ä»‹ç´¹äºº
- first_month_commission (numeric) = é¦–æœˆä½£é‡‘
- subsequent_month_commission (numeric) = å¾ŒçºŒæœˆä»½ä½£é‡‘

[public.voucher_rate]
- id (uuid, NOT NULL, default gen_random_uuid()) = ç³»çµ± ID
- service_type (service_type_enum) = æœå‹™é¡å‹
- service_rate (numeric, NOT NULL) = æœå‹™è²»ç‡ï¼ˆæ¯å°æ™‚ï¼‰
- created_at (timestamptz, default now()) = å»ºç«‹æ™‚é–“
- updated_at (timestamptz, default now()) = æ›´æ–°æ™‚é–“

------------------------------------------------------------------------
ENUM TYPESï¼ˆåˆ—èˆ‰å‹åˆ¥ï¼‰
contract_status_enum = { åŒæ„, ä¸åŒæ„ }
copay_level_enum = { 5%, 8%, 12%, 16%, 25%, 40% }
covid_vaccine_enum = { 1é‡, 2é‡, 3é‡, 4é‡, ç„¡æ¥ç¨®, Other }
customer_type_enum = { ç¤¾å€åˆ¸å®¢æˆ¶, æ˜å®¶è¡—å®¢, å®¶è¨ªå®¢æˆ¶ }
district_enum = { ä¸­è¥¿å€, ä¹é¾åŸå€, å…ƒæœ—å€, åŒ—å€, å—å€, å¤§åŸ”å€, å±¯é–€å€, æ±å€, æ²™ç”°å€, æ²¹å°–æ—ºå€, æ·±æ°´åŸ—å€, ç£ä»”å€, èƒç£å€, è‘µé’å€, è¥¿è²¢å€, è§€å¡˜å€, é›¢å³¶å€, é»ƒå¤§ä»™å€, æœªåˆ†é¡ï¼ˆé†«é™¢,é™¢èˆ) }
gender_enum = { ç”·, å¥³ }
health_status_enum = { è‰¯å¥½, ä¸­é¢¨, éœ€å”åŠ©, é•·æœŸç—…æ‚£, èªçŸ¥éšœç¤™ }
home_visit_status_enum = { å·²å®Œæˆ, æœªå®Œæˆ }
introducer_enum = { Kanas Leung, Joe Cheung, Candy Ho, Steven Kwok, Dr.Lee, Annie, Janet, é™¸sir, å³ç¿¹æ”¿, ä½™ç¿ è‹±, é™³å°å§MC01, æ›¾å…ˆç”Ÿ, æ¢æ›‰å³° }
lds_status_enum = { å·²å®Œæˆè©•ä¼°, å·²ç¶“æŒæœ‰, å¾…ç¤¾å·¥è©•ä¼° }
preferred_area_enum = { æ‰€æœ‰å€åŸŸ, ç£ä»”å€, ä¸­è¥¿å€, æ±å€, å—å€, æ²¹å°–æ—ºå€, æ·±æ°´åŸ—å€, ä¹é¾åŸå€, é»ƒå¤§ä»™å€, è§€å¡˜å€, è¥¿è²¢å€, æ²™ç”°å€, å¤§åŸ”å€, åŒ—å€, èƒç£å€, å±¯é–€å€, å…ƒæœ—å€, è‘µé’å€, é›¢å³¶å€ }
project_category_enum = { MCç¤¾å€åˆ¸(é†«é»ï¼‰, MCè¡—å®¢, Steven140, Steven200, Stevené†«é» }
project_manager_enum = { Candy Ho, Joe Cheung, Kanas Leung }
service_type_enum = {
  ES-è­·é€æœå‹™(é™ªè¨º),
  HC-å®¶å±…æœå‹™,
  NC-è­·ç†æœå‹™(å°ˆæ¥­â¼ˆå“¡),
  PC-åˆ°â¼¾çœ‹é¡§(è¼”åŠ©â¼ˆå“¡),
  RA-å¾©åº·é‹å‹•(è¼”åŠ©â¼ˆå“¡),
  RT-å¾©åº·é‹å‹•(OTAè¼”åŠ©â¼ˆå“¡),
  RT-å¾©åº·é‹å‹•(å°ˆæ¥­â¼ˆå“¡),
  ä¸Šé–€è©•ä¼°æœå‹™, å‚·å£è­·ç†, å…è²»æœå‹™é«”é©—
}
voucher_application_status_enum = { å·²ç¶“æŒæœ‰, ç”³è«‹ä¸­ }
staff_owner_enum = { Kanas Leung, Joe Cheung, Candy Ho }

------------------------------------------------------------------------
RLS POLICIESï¼ˆè¡Œç´šå®‰å…¨æ€§ï¼‰â€” å»ºè­°ç”Ÿç”¢ç’°å¢ƒé…ç½®

[public.billing_salary_data] 
ğŸ”’ å»ºè­°æ¬Šé™é…ç½®ï¼š
- SELECT: åƒ…é™å·²èªè­‰ç”¨æˆ¶ (auth.role() = 'authenticated')
- INSERT: åƒ…é™ç®¡ç†å“¡è§’è‰² (auth.jwt() ->> 'role' = 'admin')
- UPDATE: åƒ…é™ç®¡ç†å“¡è§’è‰² (auth.jwt() ->> 'role' = 'admin') 
- DELETE: åƒ…é™è¶…ç´šç®¡ç†å“¡ (auth.jwt() ->> 'role' = 'super_admin')

âš ï¸ ç•¶å‰è¨­å®šï¼šå° public éå¯¬ï¼Œéœ€æ”¶æ–‚è‡³ä¸Šè¿°å»ºè­°

[public.care_staff_profiles]
ğŸ”’ å»ºè­°æ¬Šé™é…ç½®ï¼š
- SELECT: å·²èªè­‰ç”¨æˆ¶å¯è®€å– (auth.role() = 'authenticated')
- INSERT: ç®¡ç†å“¡å’ŒHRè§’è‰² (auth.jwt() ->> 'role' IN ('admin', 'hr'))
- UPDATE: ç®¡ç†å“¡ã€HRæˆ–æœ¬äºº (auth.jwt() ->> 'role' IN ('admin', 'hr') OR auth.uid()::text = user_id)
- DELETE: åƒ…é™è¶…ç´šç®¡ç†å“¡ + äºŒæ¬¡ç¢ºèª

ğŸ”§ Storage æ¬Šé™ (care-staff-files bucket)ï¼š
- ä¸Šè¼‰: å·²èªè­‰ç”¨æˆ¶é™åˆ¶æª”æ¡ˆé¡å‹(.jpg,.png,.pdf) æœ€å¤§10MB
- è®€å–: ç°½åURLï¼Œ24å°æ™‚æœ‰æ•ˆæœŸ
- åˆªé™¤: åƒ…é™ç®¡ç†å“¡è§’è‰²

âš ï¸ ç•¶å‰è¨­å®šï¼šå…è¨± public å­˜å–ï¼Œéœ€æ”¶æ–‚è‡³ä¸Šè¿°å»ºè­°

[public.customer_personal_data]
ğŸ”’ å»ºè­°æ¬Šé™é…ç½®ï¼š
- SELECT: å·²èªè­‰ç”¨æˆ¶ (auth.role() = 'authenticated')
- INSERT: ç®¡ç†å“¡å’Œæ¥­å‹™è§’è‰² (auth.jwt() ->> 'role' IN ('admin', 'business'))
- UPDATE: ç®¡ç†å“¡ã€æ¥­å‹™æˆ–è² è²¬åŒäº‹ (auth.jwt() ->> 'role' IN ('admin', 'business') OR auth.jwt() ->> 'email' = project_manager)
- DELETE: åƒ…é™è¶…ç´šç®¡ç†å“¡ + è»Ÿåˆªé™¤æ©Ÿåˆ¶

ğŸ”§ ç”Ÿç”¢ç’°å¢ƒå¯¦æ–½æ­¥é©Ÿï¼š
1. å»ºç«‹ç”¨æˆ¶è§’è‰²è¡¨ (user_roles) 
2. å¯¦ä½œ JWT Claims æ›´æ–°
3. æ®µéšå¼æ”¶æ–‚æ¬Šé™ (å…ˆè¨˜éŒ„ï¼Œå†é™åˆ¶)
4. å¯¦ä½œå¯©è¨ˆæ—¥èªŒ (audit_logs)

------------------------------------------------------------------------
TRIGGERSï¼ˆè§¸ç™¼å™¨ï¼‰
[public.billing_salary_data] â†’ update_billing_salary_data_updated_at()
[public.care_staff_profiles] â†’ auto_generate_staff_id()
[public.customer_personal_data] â†’ update_age_from_dob()

------------------------------------------------------------------------
OPTION TABLESï¼ˆä¸‹æ‹‰ / å¤šé¸ä¾†æºï¼‰

[public.job_position_options] â†’ ç”³è«‹è·ä½å€™é¸å€¼ä¾†æº
| ID | Label |
|----|--------------------------------|
| 1  | é™ªè¨ºå“¡ (Medical Escort)        |
| 2  | å±…å®¶ç…§é¡§å“¡(PCW)                |
| 3  | å®¶å‹™åŠ©ç†(Housekeeper)          |
| 4  | é†«è­·æ”¯æ´äººå“¡(CRSW)             |
| 5  | ä¿å¥å“¡(HCW)                    |
| 6  | ç™»è¨˜è­·å£«(EN)                   |
| 7  | è¨»å†Šè­·å£«(RN)                   |
| 8  | è­·å£«å­¸ç”Ÿ                       |
| 9  | ä¸­åœ‹è­·å£«                       |
| 10 | è¨»å†Šç‡Ÿé¤Šå¸«(Dietitian)          |
| 11 | è·æ¥­æ²»ç™‚å¸«(OT)                 |
| 12 | è¨€èªæ²»ç™‚å¸«(ST)                 |
| 13 | ç‰©ç†æ²»ç™‚å¸«(PT)                 |
| 14 | é†«ç”Ÿ(Doctor)                   |
| 15 | æŠ½è¡€å“¡(Phlebotomist)           |
| 16 | ç‰©ç†æ²»ç™‚åŠ©ç† (PTA)             |
| 17 | è·æ¥­æ²»ç™‚åŠ©ç† (OTA)             |

[public.language_options] â†’ èªè¨€å€™é¸å€¼ä¾†æº
| ID | Label   |
|----|---------|
| 1  | å»£æ±è©±  |
| 2  | è‹±æ–‡    |
| 3  | æ™®é€šè©±  |
| 4  | ç¦å»ºè©±  |
| 5  | æ½®å·è©±  |
| 6  | å®¢å®¶è©±  |
| 7  | ä¸Šæµ·è©±  |
| 8  | å››é‚‘è©±  |

------------------------------------------------------------------------
ï¼ˆå®Œï¼‰
